(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const un={rock:"✊",paper:"✋",scissors:"✌️",fire:"🔥"};function Nt(e,t){return e===t?"draw":e==="rock"&&t==="scissors"||e==="paper"&&t==="rock"||e==="scissors"&&t==="paper"?"win":e==="fire"?t==="scissors"||t==="paper"?"win":"lose":t==="fire"?e==="scissors"||e==="paper"?"lose":"win":"lose"}function ne(e){return un[e]||"❓"}function Ut(e,t,n){const s=ne(t),o=ne(n);return e==="win"?t==="fire"&&(n==="scissors"||n==="paper")?`${s} Fire burns ${o}! You win!`:t==="rock"&&n==="fire"?`${s} Rock smothers ${o}! You win!`:`${s} beats ${o}! You win!`:e==="lose"?n==="fire"&&(t==="scissors"||t==="paper")?`${o} Fire burns ${s}! You lose!`:n==="rock"&&t==="fire"?`${o} Rock smothers ${s}! You lose!`:`${o} beats ${s}! You lose!`:`${s} ties with ${o}! It's a draw!`}const f={landingPage:document.getElementById("landing-page"),gameScreen:document.getElementById("game-screen"),resultsScreen:document.getElementById("results-screen"),endlessModeBtn:document.getElementById("endless-mode-btn"),bestOf5Btn:document.getElementById("best-of-5-btn"),backToMenuBtn:document.getElementById("back-to-menu"),backToMenuResultBtn:document.getElementById("back-to-menu-btn"),playAgainBtn:document.getElementById("play-again-btn"),moveButtons:document.querySelectorAll(".move-btn"),themeToggleBtn:document.getElementById("theme-toggle-btn"),resetScoresBtn:document.getElementById("reset-scores"),soundToggleBtn:document.getElementById("sound-toggle"),playerScore:document.getElementById("player-score"),aiScore:document.getElementById("ai-score"),playerMoveDisplay:document.getElementById("player-move-display"),aiMoveDisplay:document.getElementById("ai-move-display"),resultTitle:document.getElementById("result-title"),resultMessage:document.getElementById("result-message"),playerMoveResult:document.getElementById("player-move"),aiMoveResult:document.getElementById("ai-move")};function x(e){f.landingPage.classList.add("hidden"),f.gameScreen.classList.add("hidden"),f.resultsScreen.classList.add("hidden");const t=document.getElementById(e);t?t.classList.remove("hidden"):console.error("Invalid section ID:",e)}function ue(e,t){f.playerScore.textContent=e,f.aiScore.textContent=t}function Ne(e,t){f.playerMoveDisplay.textContent=ne(e),f.aiMoveDisplay.textContent=ne(t)}function Ft(e,t,n,s){let o,a;switch(e){case"win":o="You Win!",a="win";break;case"lose":o="You Lose!",a="lose";break;case"draw":o="It's a Draw!",a="draw";break;default:o="Game Result",a=""}f.resultTitle.textContent=o,f.resultMessage.textContent=t,f.resultMessage.className=`result-message ${a}`,f.playerMoveResult.textContent=ne(n),f.aiMoveResult.textContent=ne(s),x("results-screen")}function fn(e){e.startEndlessMode&&f.endlessModeBtn&&f.endlessModeBtn.addEventListener("click",e.startEndlessMode),e.backToMenu&&(f.backToMenuBtn&&f.backToMenuBtn.addEventListener("click",e.backToMenu),f.backToMenuResultBtn&&f.backToMenuResultBtn.addEventListener("click",e.backToMenu)),e.playAgain&&f.playAgainBtn&&f.playAgainBtn.addEventListener("click",e.playAgain),e.makeMove&&f.moveButtons&&f.moveButtons.forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-move");e.makeMove(n)})}),e.toggleTheme&&f.themeToggleBtn&&f.themeToggleBtn.addEventListener("click",e.toggleTheme),e.resetScores&&f.resetScoresBtn&&f.resetScoresBtn.addEventListener("click",e.resetScores)}const st="rock-paper-battle",Ye={theme:"day",soundEnabled:!0,soundVolume:.5,ambientEnabled:!0,ambientVolume:.3,audioStyle:"retro",stats:{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""},achievements:{winStreak3:!1,flawlessVictory:!1,roundsPlayed10:!1},profile:{name:"Player",avatar:"👤"},unlocks:{secretMoveUnlocked:!1,secretMoveRevealed:!1},currentWinStreak:0};let _=null;function r(e=null){if(!_)try{const t=localStorage.getItem(st);_=t?JSON.parse(t):{...Ye}}catch(t){console.error("Error loading data from localStorage:",t),_={...Ye}}return e?_[e]:_}function c(e,t){const n=r();n[e]=t;try{localStorage.setItem(st,JSON.stringify(n)),_=n}catch(s){console.error("Error saving data to localStorage:",s)}}function ye(e){if(!["wins","losses","draws"].includes(e)){console.error(`Invalid stat name: ${e}`);return}const t=r("stats")||{};t[e]=(t[e]||0)+1,c("stats",t)}function Wt(){try{localStorage.removeItem(st),_={...Ye}}catch(e){console.error("Error clearing data from localStorage:",e)}}const pe={images:["logo.webp"],icons:["favicon-96x96.png","apple-touch-icon.png","favicon.svg","web-app-manifest-192x192.png","web-app-manifest-512x512.png"]};let Te=0,ve=0,Ee=!1,be=null,V=null;function mn(e=null,t=null){Ee||(Ee=!0,be=e,V=t,Te=pe.images.length+pe.icons.length,ve=0,pe.images.forEach(n=>{gn(n)}),pe.icons.forEach(n=>{hn(n)}),Te===0&&(Ee=!1,V&&typeof V=="function"&&V()))}function gn(e){const t=new Image;t.onload=()=>{Re()},t.onerror=()=>{console.warn(`Failed to load image file: ${e}`),Re()},t.src=`./images/${e}`,e.split(".")[0]}function hn(e){const t=new Image;t.onload=()=>{Re()},t.onerror=()=>{console.warn(`Failed to load icon file: ${e}`),Re()},t.src=`./icons/${e}`,e.split(".")[0]}function Re(e){ve++;const t=Math.floor(ve/Te*100);be&&typeof be=="function"&&be(t),ve>=Te&&(Ee=!1,V&&typeof V=="function"&&V())}const pn={click:"click.wav",win:"win.wav",lose:"lose.wav",draw:"draw.wav",gameStart:"gameStart.wav",gameWin:"gameWin.wav",gameLose:"gameLose.wav",gameDraw:"gameDraw.wav",countdown:"countdown.wav",tick:"tick.wav",timeUp:"timeUp.wav",bonusRound:"bonusRound.wav",chaos:"chaos.wav"},_t={wind:"wind.wav",hum:"hum.wav",lofi:"lo-fi-loop.wav"},Ge={},ze={},we={},ke={};let k=!0,O=!0,se=.5,H=.3,E=null,Y="retro";function ot(){k=r("soundEnabled")!==!1,O=r("ambientEnabled")!==!1,Y=r("audioStyle")||"retro";const e=r("soundVolume");e!=null&&(se=parseFloat(e));const t=r("ambientVolume");t!=null&&(H=parseFloat(t)),it(),yn(),k&&O&&setTimeout(()=>{T()},1e3),console.log("Sound settings initialized:",{soundEnabled:k,ambientEnabled:O,volume:se,ambientVolume:H,audioStyle:Y})}function yn(){Object.entries(pn).forEach(([e,t])=>{Ge[e]=new Audio(`./audio/retro/${t}`),Ge[e].load(),ze[e]=new Audio(`./audio/modern/${t}`),ze[e].load()}),Object.entries(_t).forEach(([e,t])=>{we[e]=new Audio(`./audio/retro/ambient/${t}`),we[e].loop=!0,we[e].load(),ke[e]=new Audio(`./audio/modern/ambient/${t}`),ke[e].loop=!0,ke[e].load()})}function it(){const e=document.getElementById("sound-toggle");e&&(e.textContent=k?"🔊":"🔇",e.title=k?"Sound On (Click to Mute)":"Sound Off (Click to Unmute)")}function i(e){if(!k)return;const n=(Y==="retro"?Ge:ze)[e];if(!n)return;const s=n.cloneNode();s.volume=se,s.play().catch(o=>console.warn("Error playing sound:",o))}function T(e="lofi"){!k||!O||(A(),E=(Y==="retro"?we:ke)[e],!E)||(E=E.cloneNode(),E.volume=H,E.loop=!0,E.play().catch(n=>console.warn("Error playing ambient sound:",n)))}function A(){E&&(E.pause(),E.currentTime=0,E=null)}function at(){k=!k,c("soundEnabled",k),it(),k?(i("click"),O&&T()):A()}function ce(e){console.log("setSoundEnabled called with:",e),k=e,c("soundEnabled",e),it(),e?O&&T():A()}function re(){return k}function Ce(e){console.log("setAmbientEnabled called with:",e),O=e,c("ambientEnabled",e),e?k&&T():A()}function ct(){return O}function rt(e){se=Math.max(0,Math.min(1,e)),c("soundVolume",se)}function lt(){return se}function dt(e){H=Math.max(0,Math.min(1,e)),c("ambientVolume",H),E&&(E.volume=H)}function ut(){return H}function Oe(e){if(e!=="modern"&&e!=="retro")return;if(Y=e,c("audioStyle",Y),E!==null){const n=vn();A(),k&&O&&T(n)}}function vn(){if(!E)return"lofi";for(const[e,t]of Object.entries(_t))if(E.src.includes(t))return e;return"lofi"}function ft(){return Y}const En={init:ot,play:i,playAmbient:T,stopAmbient:A,toggleSound:at,setSoundEnabled:ce,isSoundEnabled:re,setAmbientEnabled:Ce,isAmbientEnabled:ct,setVolume:rt,getVolume:lt,setAmbientVolume:dt,getAmbientVolume:ut,setAudioStyle:Oe,getAudioStyle:ft},Vt=Object.freeze(Object.defineProperty({__proto__:null,default:En,getAmbientVolume:ut,getAudioStyle:ft,getVolume:lt,init:ot,isAmbientEnabled:ct,isSoundEnabled:re,play:i,playAmbient:T,setAmbientEnabled:Ce,setAmbientVolume:dt,setAudioStyle:Oe,setSoundEnabled:ce,setVolume:rt,stopAmbient:A,toggleSound:at},Symbol.toStringTag,{value:"Module"})),Je={winStreak3:{id:"winStreak3",name:"3 Wins in a Row",description:"Win 3 games in a row",icon:"🥉"},flawlessVictory:{id:"flawlessVictory",name:"Flawless Victory",description:"Win all rounds in a Best of 5 match",icon:"🥇"},roundsPlayed10:{id:"roundsPlayed10",name:"10 Total Rounds Played",description:"Play 10 or more rounds",icon:"📊"}};let K=0;function bn(){r("achievements")||c("achievements",{winStreak3:!1,flawlessVictory:!1,roundsPlayed10:!1}),K=r("currentWinStreak")||0}function mt(e,t={},n="endless"){e==="win"?K++:e==="lose"&&(K=0),c("currentWinStreak",K),K>=3&&He("winStreak3"),n==="bestOf5"&&t.gameOver&&t.playerScore>=3&&t.aiScore===0&&He("flawlessVictory");const s=r("stats");(s.wins||0)+(s.losses||0)+(s.draws||0)>=10&&He("roundsPlayed10")}function He(e){if(!Je[e]){console.error(`Achievement "${e}" does not exist`);return}const t=r("achievements");t[e]||(t[e]=!0,c("achievements",t),i("win"),wn(Je[e]))}function wn(e){const t=document.createElement("div");t.className="achievement-notification",t.innerHTML=`
        <div class="achievement-icon">${e.icon}</div>
        <div class="achievement-content">
            <h3>Achievement Unlocked!</h3>
            <p class="achievement-name">${e.name}</p>
            <p class="achievement-description">${e.description}</p>
        </div>
    `,document.body.appendChild(t),setTimeout(()=>{t.classList.add("show")},100),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{document.body.removeChild(t)},500)},5e3)}function kn(){const e=r("achievements")||{};return Object.values(Je).map(t=>({...t,unlocked:e[t.id]||!1}))}function Ke(){c("achievements",{winStreak3:!1,flawlessVictory:!1,roundsPlayed10:!1}),K=0,c("currentWinStreak",0)}function Sn(){r("stats")||c("stats",{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""})}function Ht(e){const t=r("stats");e>t.longestWinStreak&&(t.longestWinStreak=e,c("stats",t))}function Qe(e){const t=r("stats");t.bestMode=e,c("stats",t)}function jt(){const e=r("stats")||{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:"None"},t=document.getElementById("stats-wins"),n=document.getElementById("stats-losses"),s=document.getElementById("stats-draws"),o=document.getElementById("stats-streak"),a=document.getElementById("stats-best-mode"),l=document.getElementById("stats-win-rate"),u=document.getElementById("stats-total-games");t&&(t.textContent=e.wins),n&&(n.textContent=e.losses),s&&(s.textContent=e.draws),o&&(o.textContent=e.longestWinStreak),a&&(a.textContent=e.bestMode||"None");const y=e.wins+e.losses+e.draws,v=y>0?Math.round(e.wins/y*100):0;l&&(l.textContent=`${v}%`),u&&(u.textContent=y),In(e,y)}function In(e,t){const n=document.getElementById("stats-wins-bar"),s=document.getElementById("stats-losses-bar"),o=document.getElementById("stats-draws-bar");if(!n||!s||!o)return;const a=t>0?Math.max(2,e.wins/t*100):2,l=t>0?Math.max(2,e.losses/t*100):2,u=t>0?Math.max(2,e.draws/t*100):2;n.style.width=`${a}%`,s.style.width=`${l}%`,o.style.width=`${u}%`}function Xe(){c("stats",{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""}),jt(),i("click")}function Mn(){document.getElementById("landing-page").classList.add("hidden"),document.getElementById("game-screen").classList.add("hidden"),document.getElementById("results-screen").classList.add("hidden"),document.getElementById("stats-screen").classList.remove("hidden"),jt(),i("click")}function Bn(){document.getElementById("stats-screen").classList.add("hidden"),document.getElementById("landing-page").classList.remove("hidden"),i("click")}const Ln=10;let oe=!1;function gt(){oe=(r("unlocks")||{}).secretMoveUnlocked||!1,An(),ht()}function An(){if(oe)return;((r("stats")||{}).wins||0)>=Ln&&Tn()}function Tn(){oe=!0;const e=r("unlocks")||{};e.secretMoveUnlocked=!0,c("unlocks",e),ht(),setTimeout(Rn,1e3)}function ht(){const e=document.getElementById("fire-move-btn");if(e)if(oe){e.classList.remove("hidden");const t=r("unlocks")||{};t.secretMoveUnlocked&&!t.secretMoveRevealed&&(e.classList.add("fire-reveal"),t.secretMoveRevealed=!0,c("unlocks",t),setTimeout(()=>{e.classList.add("fire-glow"),setTimeout(()=>{e.classList.remove("fire-glow")},5e3)},1e3))}else e.classList.add("hidden")}function Rn(){const e=document.createElement("div");e.className="achievement-notification",e.innerHTML=`
        <div class="achievement-icon">🔥</div>
        <div class="achievement-content">
            <h3>New Move Unlocked!</h3>
            <p class="achievement-name">Fire Move</p>
            <p class="achievement-description">You've unlocked the secret Fire move!</p>
        </div>
    `,document.body.appendChild(e),i("win"),setTimeout(()=>{e.classList.add("show")},100),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{document.body.removeChild(e)},500)},5e3)}function fe(){return oe}function Ze(){oe=!1;const e=r("unlocks")||{};e.secretMoveUnlocked=!1,e.secretMoveRevealed=!1,c("unlocks",e),ht()}const g={EASY:"easy",MEDIUM:"medium",HARD:"hard",IMPOSSIBLE:"impossible"};let R=g.MEDIUM;const P={rock:0,paper:0,scissors:0,fire:0},j=[],Cn=10,q={"rock-rock":0,"rock-paper":0,"rock-scissors":0,"paper-rock":0,"paper-paper":0,"paper-scissors":0,"scissors-rock":0,"scissors-paper":0,"scissors-scissors":0};let Q=null,le=null;const W={wins:0,losses:0,draws:0,lastOutcomes:[]};function On(){const e=r("aiDifficulty");e&&Object.values(g).includes(e)?R=e:c("aiDifficulty",g.MEDIUM);const t=r("aiMode");if(t){switch(t){case"random":c("aiDifficulty",g.EASY),R=g.EASY;break;case"predictive":c("aiDifficulty",g.HARD),R=g.HARD;break;default:c("aiDifficulty",g.MEDIUM),R=g.MEDIUM}localStorage.removeItem("aiMode")}Ue()}function Ue(){P.rock=0,P.paper=0,P.scissors=0,P.fire=0,j.length=0,Object.keys(q).forEach(e=>{q[e]=0}),Q=null,le=null,W.lastOutcomes=[]}function qt(e){if(le=e,P[e]!==void 0&&P[e]++,j.push(e),j.length>Cn&&j.shift(),Q&&e){const t=`${Q}-${e}`;q[t]!==void 0&&q[t]++}Q=e}function X(e){e==="win"?W.wins++:e==="loss"?W.losses++:e==="draw"&&W.draws++,W.lastOutcomes.unshift(e),W.lastOutcomes.length>5&&W.lastOutcomes.pop()}function Yt(e){switch(R){case g.EASY:return Z(e);case g.MEDIUM:return Math.random()<.5?et(e):Z(e);case g.HARD:return et(e);case g.IMPOSSIBLE:return $n(e);default:return Z(e)}}function et(e){if(j.length<3)return Z(e);if(Math.random()<.3&&Q){let n=0,s=null;if(Object.keys(q).forEach(o=>{o.startsWith(Q+"-")&&q[o]>n&&(n=q[o],s=o.split("-")[1])}),s&&n>1){const o=ae(s);if(e.includes(o))return o}}if(Math.random()<.4){let n="rock",s=0;for(const[a,l]of Object.entries(P))l>s&&(s=l,n=a);const o=ae(n);if(e.includes(o))return o}if(Math.random()<.3&&j.length>=3){const n=j.slice(-3);if(n[1]===n[2]){const s=ae(n[2]);if(e.includes(s))return s}if(n[0]===n[2]&&n[0]!==n[1]){const s=ae(n[0]);if(e.includes(s))return s}}return Z(e)}function $n(e){if(le&&P[le]!==void 0){const t=ae(le);if(e.includes(t))return t}return et(e)}function Z(e){const t=Math.floor(Math.random()*e.length);return e[t]}function ae(e){switch(e){case"rock":return"paper";case"paper":return"scissors";case"scissors":return"rock";case"fire":return"rock";default:return"rock"}}function Dn(e){Object.values(g).includes(e)?(R=e,c("aiDifficulty",e),Ue()):console.error(`Invalid AI difficulty: ${e}`)}function Fe(){return R}function xn(){switch(R){case g.EASY:return"Noobron";case g.MEDIUM:return"Median Mind";case g.HARD:return"Mindbreaker";case g.IMPOSSIBLE:return"Impossible";default:return"Median Mind"}}function Pn(){switch(R){case g.EASY:return"🤓";case g.MEDIUM:return"🤖";case g.HARD:return"👾";case g.IMPOSSIBLE:return"👹";default:return"🤖"}}function Gt(){const e=document.getElementById("ai-avatar");e&&(e.textContent=Pn(),e.title=xn(),e.className="avatar-small",e.classList.add(`ai-${Fe()}-difficulty`));const t=document.getElementById("ai-mode-indicator");t&&(t.style.display="none");const n=document.getElementById("ai-difficulty-indicator");n&&(n.style.display="none")}const zt=3e3,Jt=50,Nn=1e3;let me=!1,Se=null,Ie=null,z=0,Me=null,M=null,ge=!1,Kt=null;function Un(){const e=r("speedMode");e!==void 0?me=e:(c("speedMode",!1),me=!1),Fn()}function je(e){if(Kt=e,e!=="endless"){ge&&$();const t=document.getElementById("game-info-banner");t&&(t.classList.add("hidden"),window.speedModeTextInterval&&(clearInterval(window.speedModeTextInterval),window.speedModeTextInterval=null))}else Qt()}function G(){return me&&Kt==="endless"}function Fn(){if(document.getElementById("speed-timer")){M=document.getElementById("speed-timer");return}const e=document.createElement("div");e.id="speed-timer-container",e.className="speed-timer-container hidden",M=document.createElement("div"),M.id="speed-timer",M.className="speed-timer",e.appendChild(M);const t=document.getElementById("game-screen");if(t){const n=t.querySelector(".game-header");n?n.insertAdjacentElement("afterend",e):t.insertAdjacentElement("afterbegin",e)}else document.body.appendChild(e)}function Wn(){return me}function _n(e){me=e,c("speedMode",e),Qt()}function Qt(){const e=document.getElementById("game-info-banner"),t=document.getElementById("game-info-text"),n=document.querySelector(".game-info-banner-icon");if(e&&t&&n)if(G()){if(e.classList.remove("hidden"),e.classList.add("speed-mode"),t.textContent="Speed Mode Active",n.textContent="⚡",!window.speedModeTextInterval){let s=!0;window.speedModeTextInterval=setInterval(()=>{s=!s,t.textContent=`Speed Mode Active${s?" |":""}`},500)}}else e.classList.add("hidden"),window.speedModeTextInterval&&(clearInterval(window.speedModeTextInterval),window.speedModeTextInterval=null)}function Vn(e=zt,t=null){if(!G()||ge)return!1;Me=t,z=e,ge=!0;const n=document.getElementById("speed-timer-container");return n&&n.classList.remove("hidden"),M&&(M.style.width="100%",M.classList.remove("warning")),$(!1),Se=setTimeout(()=>{Hn()},e),Ie=setInterval(()=>{jn()},Jt),i("countdown"),!0}function $(e=!0){if(Se&&(clearTimeout(Se),Se=null),Ie&&(clearInterval(Ie),Ie=null),ge=!1,e){const t=document.getElementById("speed-timer-container");t&&t.classList.add("hidden")}}function Hn(){i("timeUp"),Me&&typeof Me=="function"&&Me(),$()}function jn(){if(!M||!ge)return;z-=Jt,z<0&&(z=0);const e=z/zt*100;M.style.width=`${e}%`,z<=Nn&&!M.classList.contains("warning")&&(M.classList.add("warning"),i("tick"))}function qn(e){return Z(e)}function Yn(e=1e3,t=300){return G()?t:e}function Gn(){$(),window.speedModeTextInterval&&(clearInterval(window.speedModeTextInterval),window.speedModeTextInterval=null)}const zn=.2,D={DOUBLE_POINTS:"double-points",REVERSE_RULES:"reverse-rules",CHAOS_MODE:"chaos-mode"};let We=!0,C=null,de={};function Jn(){const e=r("bonusEnabled");e!==void 0?We=e:c("bonusEnabled",!0)}function Xt(){return We}function Kn(e){We=e,c("bonusEnabled",e)}function Qn(){return We?Math.random()<zn:!1}function Xn(){C&&ee();const e=Object.values(D),t=Math.floor(Math.random()*e.length),n=e[t];return Zn(n),n}function Zn(e){if(!Object.values(D).includes(e)){console.error(`Invalid bonus type: ${e}`);return}C=e,es(e),ss(e),i("bonusRound")}function es(e){const t=document.querySelector(".game-area");switch(t&&(t.classList.add("bonus-round"),t.classList.add(e)),e){case D.CHAOS_MODE:ts();break}}function ts(){const e=document.querySelectorAll(".move-btn:not(.hidden)");if(e.length<2)return;de={},e.forEach(n=>{const s=n.getAttribute("data-move");de[s]=n.textContent}),Array.from(e).map(n=>n.getAttribute("data-move"));const t=Array.from(e).map(n=>n.textContent);for(let n=t.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[t[n],t[s]]=[t[s],t[n]]}e.forEach((n,s)=>{n.textContent=t[s],n.classList.add("chaos-mode-btn")}),i("chaos")}function ee(){if(!C)return;const e=document.querySelector(".game-area");switch(e&&(e.classList.remove("bonus-round"),e.classList.remove(C)),C){case D.CHAOS_MODE:ns();break}C=null}function ns(){document.querySelectorAll(".move-btn").forEach(t=>{const n=t.getAttribute("data-move");de[n]&&(t.textContent=de[n]),t.classList.remove("chaos-mode-btn")}),de={}}function ss(e){let t,n,s;switch(e){case D.DOUBLE_POINTS:t="Double Points Round!",n="Win this round to earn double points!",s="🎯";break;case D.REVERSE_RULES:t="Reverse Rules!",n="The rules are reversed! Rock beats Paper, Paper beats Scissors, Scissors beats Rock!",s="🔁";break;case D.CHAOS_MODE:t="Chaos Mode!",n="Move labels are scrambled! Choose wisely!",s="🎲";break;default:t="Bonus Round!",n="Special rules apply this round!",s="🎁"}const o=document.createElement("div");o.className="bonus-notification",o.innerHTML=`
        <div class="bonus-notification-icon">${s}</div>
        <div class="bonus-notification-content">
            <h3>${t}</h3>
            <p>${n}</p>
        </div>
    `,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{document.body.removeChild(o)},500)},4e3)}function os(e,t,n){if(!C)return e;switch(C){case D.REVERSE_RULES:return is(e,t,n);default:return e}}function is(e,t,n){if(t===n)return"draw";if(t==="rock"&&n==="paper"||t==="paper"&&n==="scissors"||t==="scissors"&&n==="rock")return"win";if(t==="paper"&&n==="rock"||t==="scissors"&&n==="paper"||t==="rock"&&n==="scissors")return"lose";if(t==="fire"){if(n==="scissors"||n==="paper")return"win";if(n==="rock")return"lose"}if(n==="fire"){if(t==="scissors"||t==="paper")return"lose";if(t==="rock")return"win"}return e}function as(){return C===D.DOUBLE_POINTS?2:1}const m={playerScore:0,aiScore:0,currentRound:0,lastPlayerMove:null,lastAiMove:null,lastResult:null,bonusRoundActive:!1,bonusType:null,timeoutMove:null};function cs(){Zt(),document.querySelector("#game-screen h2").textContent="Endless Mode";const e=document.getElementById("game-screen");e&&e.classList.remove("best-of-5-mode"),Gt();const t=r("stats");t?ue(t.wins,t.losses):ue(0,0),x("game-screen"),i("gameStart"),G()&&pt()}function pt(){G()&&Vn(3e3,()=>{const t=fe()?["rock","paper","scissors","fire"]:["rock","paper","scissors"],n=qn(t);m.timeoutMove=n,$e(n,!0)})}function Zt(){m.currentRound=0,m.lastPlayerMove=null,m.lastAiMove=null,m.lastResult=null,m.bonusRoundActive=!1,m.bonusType=null,m.timeoutMove=null,Ne("",""),Ue(),ee()}function $e(e,t=!1){qt(e),!m.bonusRoundActive&&Xt()&&Qn()&&(m.bonusRoundActive=!0,m.bonusType=Xn());const s=fe()?["rock","paper","scissors","fire"]:["rock","paper","scissors"],o=Yt(s);let a=Nt(e,o);m.bonusRoundActive&&(a=os(a,e,o)),m.lastPlayerMove=e,m.lastAiMove=o,m.lastResult=a,m.currentRound++,Ne(e,o),ls(a,t),i(a==="win"?"win":a==="lose"?"lose":"draw"),mt(a,m,"endless"),fe()||gt();const l=Ut(a,e,o);rs(a);const u=Yn(1e3,500);setTimeout(()=>{Ft(a,l,e,o),m.bonusRoundActive&&(ee(),m.bonusRoundActive=!1,m.bonusType=null)},u)}function rs(e){const t=document.getElementById("player-move-display"),n=document.getElementById("ai-move-display");switch(e){case"win":window.showWinAnimation&&window.showWinAnimation();break;case"lose":window.showLossAnimation&&t&&window.showLossAnimation(t);break;case"draw":window.showDrawAnimation&&t&&n&&(window.showDrawAnimation(t),window.showDrawAnimation(n));break}}function ls(e,t){const n=m.bonusRoundActive?as():1;if(t&&e!=="win"&&(e="lose"),e==="win"){for(let o=0;o<n;o++)ye("wins");X("loss")}else e==="lose"?(ye("losses"),X("win")):(ye("draws"),X("draw"));m.bonusRoundActive&&e==="win"&&ds();const s=r("stats");if(ue(s.wins,s.losses),e==="win"){const o=r("currentWinStreak")||0;Ht(o)}us(e)}function ds(){const e=r("bonusRoundsWon")||0;c("bonusRoundsWon",e+1);const t=document.getElementById("stats-bonus-rounds");t&&(t.textContent=e+1)}function us(e){if(e!=="win")return;const t=Fe(),n=r("aiStats")||{easy:{wins:0},medium:{wins:0},hard:{wins:0},impossible:{wins:0}};n[t]||(n[t]={wins:0}),n[t].wins=(n[t].wins||0)+1,c("aiStats",n);const s=document.getElementById("stats-best-ai-mode");if(s){let o="medium",a=0;for(const[y,v]of Object.entries(n))v.wins>a&&(a=v.wins,o=y);let l="Median Mind",u="😐";switch(o){case"easy":l="Noobron",u="🤓";break;case"hard":l="Mindbreaker",u="👾";break;case"impossible":l="Impossible",u="👹";break;default:l="Median Mind",u="🤖";break}s.textContent=`${u} ${l}`}}function fs(){i("click"),x("landing-page"),$()}function ms(){i("click"),x("game-screen"),G()&&pt()}function gs(){const e=r();e.stats.wins=0,e.stats.losses=0,e.stats.draws=0,c("stats",e.stats),ue(0,0),Zt(),c("currentWinStreak",0),i("click"),G()&&pt()}const d={playerScore:0,aiScore:0,currentRound:0,maxRounds:5,lastPlayerMove:null,lastAiMove:null,lastResult:null,gameOver:!1};function hs(){yt(),document.querySelector("#game-screen h2").textContent="Best of 5";const e=document.getElementById("game-screen");e&&e.classList.add("best-of-5-mode"),Gt(),x("game-screen"),i("gameStart");const t=document.getElementById("game-info-banner");t&&(t.classList.add("hidden"),t.style.display="none",window.bestOf5Observer||(window.bestOf5Observer=new MutationObserver(n=>{for(const s of n)(s.attributeName==="class"||s.attributeName==="style")&&(t.classList.add("hidden"),t.style.display="none")}),window.bestOf5Observer.observe(t,{attributes:!0})))}function yt(){d.playerScore=0,d.aiScore=0,d.currentRound=0,d.lastPlayerMove=null,d.lastAiMove=null,d.lastResult=null,d.gameOver=!1,Ne("",""),en(),Ue()}function en(){ue(d.playerScore,d.aiScore)}function tt(e){if(d.gameOver)return;qt(e);const n=fe()?["rock","paper","scissors","fire"]:["rock","paper","scissors"],s=Yt(n),o=Nt(e,s);d.lastPlayerMove=e,d.lastAiMove=s,d.lastResult=o,d.currentRound++,o==="win"?(d.playerScore++,i("win"),X("loss")):o==="lose"?(d.aiScore++,i("lose"),X("win")):(i("draw"),X("draw")),en(),Ne(e,s);const a=Ut(o,e,s),l=ys();if(mt(o,d,"bestOf5"),fe()||gt(),setTimeout(()=>{l?vs():Ft(o,a,e,s)},1e3),ye(o==="win"?"wins":o==="lose"?"losses":"draws"),o==="win"){const y=r("currentWinStreak")||0;Ht(y),ps(o)}}function ps(e){if(e!=="win")return;const t=Fe(),n=r("aiStats")||{easy:{wins:0},medium:{wins:0},hard:{wins:0},impossible:{wins:0}};n[t]||(n[t]={wins:0}),n[t].wins=(n[t].wins||0)+1,c("aiStats",n);const s=document.getElementById("stats-best-ai-mode");if(s){let o="random",a=0;for(const[y,v]of Object.entries(n))v.wins>a&&(a=v.wins,o=y);let l="Random",u="🤖";switch(o){case"cheeky":l="Cheeky",u="😏";break;case"predictive":l="Predictive",u="🧠";break;default:l="Random",u="🤖";break}s.textContent=`${u} ${l}`}}function ys(){return d.playerScore>=3||d.aiScore>=3||d.currentRound>=d.maxRounds?(d.gameOver=!0,!0):!1}function vs(){const e=d.playerScore>d.aiScore,t=d.playerScore===d.aiScore;let n,s,o;t?(n="It's a Draw!",s=`Final Score: ${d.playerScore}-${d.aiScore}`,o="draw",i("gameDraw")):e?(n="You Win the Match!",s=`Final Score: ${d.playerScore}-${d.aiScore}`,o="win",i("gameWin"),Qe("Best of 5"),d.aiScore===0&&mt("win",d,"bestOf5")):(n="You Lose the Match!",s=`Final Score: ${d.playerScore}-${d.aiScore}`,o="lose",i("gameLose"));const a=document.getElementById("result-title"),l=document.getElementById("result-message");a.textContent=n,l.textContent=s,l.className=`result-message ${o}`,x("results-screen")}function Es(){i("click");const e=document.getElementById("game-screen");e&&e.classList.remove("best-of-5-mode"),window.bestOf5Observer&&(window.bestOf5Observer.disconnect(),window.bestOf5Observer=null),x("landing-page")}function bs(){i("click"),d.gameOver&&yt(),x("game-screen");const e=document.getElementById("game-info-banner");e&&e.classList.add("hidden")}function ws(){yt(),i("click");const e=document.getElementById("game-info-banner");e&&e.classList.add("hidden")}const _e=["day","night","retro","neon"];let De="day";function ks(){const e=r("theme");e&&_e.includes(e)&&(De=e),tn(De)}function Ss(){document.querySelectorAll(".theme-option").forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-theme");n&&_e.includes(n)&&(vt(n),At(n),i("click"))})}),At(De)}function At(e){document.querySelectorAll(".theme-option").forEach(s=>{s.classList.remove("active")});const n=document.querySelector(`.theme-option[data-theme="${e}"]`);n&&n.classList.add("active")}function vt(e){if(!_e.includes(e)){console.error(`Theme "${e}" is not valid`);return}De=e,c("theme",e),tn(e)}function tn(e){document.body.classList.remove(..._e.map(t=>`theme-${t}`)),document.body.classList.add(`theme-${e}`)}const Et={name:"Player",avatar:"👤"};let B={...Et};function Is(){const e=r("profile");e?B=e:c("profile",Et),bt()}function Ms(){document.querySelectorAll(".avatar-option").forEach(s=>{s.addEventListener("click",()=>{const o=s.getAttribute("data-avatar");o&&(nn(o),Tt(o),i("click"))})});const t=document.getElementById("player-name-input");t&&(t.value=B.name);const n=document.getElementById("save-profile-btn");n&&n.addEventListener("click",Bs),Tt(B.avatar)}function Tt(e){document.querySelectorAll(".avatar-option").forEach(s=>{s.classList.remove("selected")});const n=document.querySelector(`.avatar-option[data-avatar="${e}"]`);n&&(n.classList.add("selected"),n.classList.add("avatar-highlight"),setTimeout(()=>{n.classList.remove("avatar-highlight")},500))}function nn(e){B.avatar=e}function Bs(){const e=document.getElementById("player-name-input");e&&e.value.trim()&&(B.name=e.value.trim()),c("profile",B),bt(),i("win"),Ls()}function Ls(){const e=document.getElementById("save-profile-btn");if(e){const t=e.textContent;e.textContent="Saved!",e.disabled=!0,setTimeout(()=>{e.textContent=t,e.disabled=!1},1500)}}function bt(){const e=document.getElementById("player-avatar"),t=document.getElementById("player-name");e&&(e.textContent=B.avatar),t&&(t.textContent=B.name);const n=document.getElementById("game-player-avatar"),s=document.getElementById("game-player-name");n&&(n.textContent=B.avatar),s&&(s.textContent=B.name)}function As(){B={...Et},c("profile",B),bt()}const Ts=7e3,Rs=1e3;let qe=null,Ve=!1,sn=Date.now(),te=[];const Cs=[".move-btn",".player-choice",".ai-choice"];function Os(){$s(),Ds()}function $s(){document.addEventListener("mousemove",L),document.addEventListener("click",L),document.addEventListener("keydown",L),document.addEventListener("touchstart",L),document.addEventListener("touchmove",L)}function Ds(){qe&&clearInterval(qe),qe=setInterval(xs,Rs)}function L(){sn=Date.now(),Ve&&Ns()}function xs(){Date.now()-sn>=Ts&&!Ve&&Ps()}function Ps(){Ve=!0,Us(),Fs(),r("ambientEnabled")!==!1&&T()}function Ns(){Ve=!1,Ws(),A()}function Us(){te=[],Cs.forEach(t=>{document.querySelectorAll(t).forEach(s=>{s.offsetParent!==null&&te.push(s)})});const e=document.querySelector("section:not(.hidden)");e&&te.push(e)}function Fs(){te.forEach((e,t)=>{e.classList.contains("idle-animation")||(e.classList.contains("move-btn")?(e.classList.add("idle-animation","idle-pulse"),e.style.animationDelay=`${t*.2}s`):e.classList.contains("player-choice")||e.classList.contains("ai-choice")?e.classList.add("idle-animation","idle-glow"):e.tagName.toLowerCase()==="section"&&e.classList.add("idle-animation","idle-background"))}),document.body.classList.add("idle")}function Ws(){te.forEach(t=>{t.classList.remove("idle-animation","idle-pulse","idle-glow","idle-background"),t.style.animationDelay=""}),document.querySelectorAll(".idle-animation").forEach(t=>{t.classList.remove("idle-animation","idle-pulse","idle-glow","idle-background"),t.style.animationDelay=""}),document.body.classList.remove("idle"),te=[]}const Rt="high-contrast",Ct="reduced-motion";let S=!1,I=!1;function _s(){Vs(),Hs(),js(),he(),console.log("Accessibility initialized:",{highContrast:S,reducedMotion:I})}function Vs(){window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(I=!0,c("reducedMotion",!0)),window.matchMedia("(prefers-contrast: more)").matches&&(S=!0,c("highContrast",!0))}function Hs(){const e=r("highContrast");e!==void 0&&(S=e);const t=r("reducedMotion");t!==void 0&&(I=t)}function js(){const e=document.getElementById("high-contrast-toggle");if(e){e.checked=S,e.addEventListener("change",s=>{s.stopPropagation(),Ot()});const n=e.parentElement;n&&n.classList.contains("toggle-switch")&&n.addEventListener("click",s=>{s.target!==e&&(s.preventDefault(),s.stopPropagation(),e.checked=!e.checked,Ot())})}const t=document.getElementById("reduced-motion-toggle");if(t){t.checked=I,t.addEventListener("change",s=>{s.stopPropagation(),$t()});const n=t.parentElement;n&&n.classList.contains("toggle-switch")&&n.addEventListener("click",s=>{s.target!==t&&(s.preventDefault(),s.stopPropagation(),t.checked=!t.checked,$t())})}window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",n=>{n.matches&&Ys(!0)}),window.matchMedia("(prefers-contrast: more)").addEventListener("change",n=>{n.matches&&qs(!0)})}function he(){requestAnimationFrame(()=>{S?(document.body.classList.add(Rt),console.log("Applied high contrast class to body")):(document.body.classList.remove(Rt),console.log("Removed high contrast class from body")),I?document.body.classList.add(Ct):document.body.classList.remove(Ct),console.log("Current accessibility settings:",{highContrast:S,reducedMotion:I,bodyClasses:document.body.className})})}function Ot(){S=!S,c("highContrast",S),he(),console.log("High contrast toggled to:",S);const e=document.getElementById("high-contrast-toggle");return e&&(e.checked=S),Vt&&i&&i("click"),S}function $t(){I=!I,c("reducedMotion",I),he();const e=document.getElementById("reduced-motion-toggle");return e&&(e.checked=I),Vt&&i&&i("click"),I}function qs(e){S=e,c("highContrast",e),he();const t=document.getElementById("high-contrast-toggle");t&&(t.checked=e)}function Ys(e){I=e,c("reducedMotion",e),he();const t=document.getElementById("reduced-motion-toggle");t&&(t.checked=e)}function Gs(){return S}function Be(){return I}const zs=1e3,Js=60;let N=!1,xe=null,p=null,nt=0,Pe=0,J=[],Dt=0,Le=1/0,Ae=0;function Ks(e=!1){N=e,Qs(),N&&on()}function Qs(){if(document.getElementById("fps-display")){p=document.getElementById("fps-display");return}p=document.createElement("div"),p.id="fps-display",p.className=N?"fps-display":"fps-display hidden",p.innerHTML=`
        <div class="fps-current">FPS: --</div>
        <div class="fps-avg">Avg: --</div>
        <div class="fps-range">Min: -- | Max: --</div>
    `;const e=document.createElement("style");e.textContent=`
        .fps-display {
            position: fixed;
            top: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            padding: 5px 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
            border-bottom-left-radius: 5px;
        }
        
        .fps-display.hidden {
            display: none;
        }
        
        .fps-current {
            font-weight: bold;
        }
        
        .fps-avg, .fps-range {
            font-size: 10px;
            opacity: 0.8;
        }
    `,document.head.appendChild(e),document.body.appendChild(p)}function on(){p&&p.classList.remove("hidden"),Pe=0,J=[],nt=performance.now(),Le=1/0,Ae=0,cancelAnimationFrame(xe),xe=requestAnimationFrame(an),setInterval(Xs,zs)}function an(e){Pe++,xe=requestAnimationFrame(an)}function Xs(){if(!N||!p)return;const e=performance.now(),t=e-nt,n=Math.round(Pe*1e3/t);J.push(n),J.length>Js&&J.shift(),Dt=Math.round(J.reduce((s,o)=>s+o,0)/J.length),Le=Math.min(Le,n),Ae=Math.max(Ae,n),p.querySelector(".fps-current").textContent=`FPS: ${n}`,p.querySelector(".fps-avg").textContent=`Avg: ${Dt}`,p.querySelector(".fps-range").textContent=`Min: ${Le} | Max: ${Ae}`,Pe=0,nt=e,n<30?p.style.color="#ff0000":n<50?p.style.color="#ffff00":p.style.color="#00ff00"}function cn(){return N=!N,N?on():(p&&p.classList.add("hidden"),cancelAnimationFrame(xe)),N}function Zs(){eo()}function eo(){const e=document.getElementById("back-from-settings");e&&e.addEventListener("click",to);const t=document.querySelectorAll(".tab-btn");t.forEach(h=>{h.addEventListener("click",()=>{const Bt=h.getAttribute("data-tab");Bt&&(rn(Bt),i("click"),t.forEach(Lt=>{Lt.setAttribute("aria-selected",Lt===h)}))})}),Ss(),Ms();const n=document.getElementById("sound-toggle-setting");n&&(n.checked=re(),console.log("Sound toggle initialized:",n.checked),n.addEventListener("change",()=>{console.log("Sound toggle changed to:",n.checked),ce(n.checked),n.checked&&i("click")}),n.parentElement.addEventListener("click",h=>{h.target!==n&&(n.checked=!n.checked,console.log("Sound toggle clicked (parent):",n.checked),ce(n.checked),n.checked&&i("click"))}));const s=document.getElementById("sound-volume");s&&(s.value=lt()*100,s.addEventListener("input",()=>{const h=s.value/100;rt(h),re()&&s.value>0&&i("tick")}));const o=document.getElementById("ambient-toggle-setting");o&&(o.checked=ct(),console.log("Ambient toggle initialized:",o.checked),o.addEventListener("change",()=>{console.log("Ambient toggle changed to:",o.checked),Ce(o.checked),o.checked?(T(),i("click")):(A(),i("click"))}),o.parentElement.addEventListener("click",h=>{h.target!==o&&(o.checked=!o.checked,console.log("Ambient toggle clicked (parent):",o.checked),Ce(o.checked),o.checked?(T(),i("click")):(A(),i("click")))}));const a=document.getElementById("ambient-volume");a&&(a.value=ut()*100,a.addEventListener("input",()=>{const h=a.value/100;dt(h),re()&&a.value>0&&i("tick")}));const l=document.getElementById("sound-style-retro"),u=document.getElementById("sound-style-modern");if(l&&u){const h=ft();l.checked=h==="retro",u.checked=h==="modern",l.addEventListener("change",()=>{l.checked&&(Oe("retro"),i("click"))}),u.addEventListener("change",()=>{u.checked&&(Oe("modern"),i("click"))})}const y=document.getElementById("test-sound-btn");y&&y.addEventListener("click",()=>{i("win")});const v=document.getElementById("ai-difficulty-select");v&&(v.value=Fe(),xt(v.value),v.addEventListener("change",()=>{const h=v.value;Dn(h),xt(h),i("click")}));const U=document.getElementById("speed-mode-toggle");U&&(U.checked=Wn(),U.addEventListener("change",()=>{_n(U.checked),i("click")}));const b=document.getElementById("bonus-rounds-toggle");b&&(b.checked=Xt(),b.addEventListener("change",()=>{Kn(b.checked),i("click")}));const ie=document.getElementById("fps-toggle");ie&&ie.addEventListener("change",()=>{cn(),i("click")});const F=document.getElementById("high-contrast-toggle");F&&(F.checked=Gs());const kt=document.getElementById("reduced-motion-toggle");kt&&(kt.checked=Be());const St=document.getElementById("reset-stats-settings-btn");St&&St.addEventListener("click",()=>{confirm("Are you sure you want to reset your statistics?")&&(Xe(),i("click"))});const It=document.getElementById("reset-achievements-btn");It&&It.addEventListener("click",()=>{confirm("Are you sure you want to reset your achievements?")&&(Ke(),Ze(),i("click"))});const Mt=document.getElementById("delete-all-data-btn");Mt&&Mt.addEventListener("click",()=>{confirm("Are you sure you want to delete ALL game data? This cannot be undone.")&&(Wt(),As(),Ke(),Xe(),Ze(),vt("day"),ce(!0),i("click"),alert("All data has been deleted. The game will now reload."),window.location.reload())})}function xt(e){const t=document.getElementById("ai-difficulty-description");let n="",s="";switch(e){case"easy":n="Noobron",s="Chill, always makes mistakes. Great for beginners or casual play.";break;case"medium":n="Median Mind",s="Keeps things fair. A balanced challenge for most players.";break;case"hard":n="Mindbreaker",s="Forces you to think harder. A serious challenge for experienced players!";break;case"impossible":n="Impossible",s="Impossible to Beat. Only for those seeking the ultimate challenge!";break;default:n="Median Mind",s="Keeps things fair. A balanced challenge for most players.";break}t&&(t.innerHTML=`
            <h4>${n}</h4>
            <p>${s}</p>
        `)}function rn(e){document.querySelectorAll(".tab-content").forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-hidden","true")});const n=document.getElementById(`${e}-tab`);n&&(n.classList.add("active"),n.setAttribute("aria-hidden","false")),document.querySelectorAll(".tab-btn").forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-selected","false"),o.getAttribute("data-tab")===e&&(o.classList.add("active"),o.setAttribute("aria-selected","true"))})}function ln(){document.getElementById("landing-page").classList.add("hidden"),document.getElementById("game-screen").classList.add("hidden"),document.getElementById("results-screen").classList.add("hidden"),document.getElementById("stats-screen").classList.add("hidden"),document.getElementById("settings-screen").classList.remove("hidden"),rn("profile"),i("click")}function to(){document.getElementById("settings-screen").classList.add("hidden"),document.getElementById("landing-page").classList.remove("hidden"),i("click")}const wt="1.0";function no(){try{const e=so();e.metadata={version:wt,exportDate:new Date().toISOString(),game:"RockPaperBattle"};const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(n),o=document.createElement("a");return o.href=s,o.download=`rock-paper-battle-save-${io(new Date)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),!0}catch(e){return console.error("Failed to export game data:",e),!1}}function so(){const e=r();return{settings:{soundEnabled:e.soundEnabled||!1,soundVolume:e.soundVolume||.5,ambientEnabled:e.ambientEnabled||!1,ambientVolume:e.ambientVolume||.3,audioStyle:e.audioStyle||"retro",theme:e.theme||"day",highContrast:e.highContrast||!1,reducedMotion:e.reducedMotion||!1},profile:e.profile||{name:"Player",avatar:"👤"},stats:e.stats||{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""},achievements:e.achievements||{},game:{currentWinStreak:e.currentWinStreak||0,unlocks:e.unlocks||{},bonusRoundsEnabled:e.bonusRoundsEnabled||!0,speedModeEnabled:e.speedModeEnabled||!1},other:oo()}}function oo(){const e={};return Object.keys(localStorage).forEach(n=>{if(n.startsWith("RockPaperBattle_")||n==="hasRunBefore")try{e[n]=JSON.parse(localStorage.getItem(n))}catch{e[n]=localStorage.getItem(n)}}),e}function io(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function ao(e){return new Promise((t,n)=>{if(!e){n({success:!1,message:"No file provided"});return}if(e.type!=="application/json"&&!e.name.endsWith(".json")){n({success:!1,message:"Invalid file type. Please select a JSON file"});return}const s=new FileReader;s.onload=o=>{try{const a=JSON.parse(o.target.result),l=co(a);if(!l.valid){n({success:!1,message:l.message});return}confirm("This will replace your current game data. Continue?")?(lo(a),t({success:!0,message:"Game data imported successfully!",stats:uo(a)})):n({success:!1,message:"Import cancelled by user"})}catch(a){n({success:!1,message:`Failed to import data: ${a.message}`})}},s.onerror=()=>{n({success:!1,message:"Error reading file"})},s.readAsText(e)})}function co(e){if(!e.metadata)return{valid:!1,message:"Invalid save file: Missing metadata"};if(e.metadata.game!=="RockPaperBattle")return{valid:!1,message:"Invalid save file: Not a Rock Paper Battle save file"};const t=e.metadata.version||"0";return ro(t)?!e.settings&&!e.profile&&!e.stats&&!e.achievements&&!e.game&&!e.other&&Object.keys(e).length<=1?{valid:!1,message:"Invalid save file: No game data found"}:{valid:!0}:{valid:!1,message:`Incompatible save file version: ${t} (current: ${wt})`}}function ro(e){const t=wt.split(".")[0],n=e.split(".")[0];return t===n}function lo(e){if(delete e.metadata,Wt(),e.settings||e.profile||e.stats){const t={...e.settings,profile:e.profile,stats:e.stats,achievements:e.achievements,unlocks:e.game?.unlocks,currentWinStreak:e.game?.currentWinStreak,bonusRoundsEnabled:e.game?.bonusRoundsEnabled,speedModeEnabled:e.game?.speedModeEnabled};Object.entries(t).forEach(([n,s])=>{c(n,s)}),e.other&&Object.entries(e.other).forEach(([n,s])=>{try{localStorage.setItem(n,typeof s=="string"?s:JSON.stringify(s))}catch(o){console.error(`Failed to import key ${n}:`,o)}})}else Object.entries(e).forEach(([t,n])=>{try{localStorage.setItem(t,typeof n=="string"?n:JSON.stringify(n))}catch(s){console.error(`Failed to import key ${t}:`,s)}})}function uo(e){const t={totalItems:0,achievements:0,stats:!1,profile:!1};if(e.settings||e.profile||e.stats)t.totalItems=Object.keys(e).length-1,e.achievements&&(t.achievements=Object.values(e.achievements).filter(n=>n===!0||n.unlocked===!0).length),e.stats&&(t.stats=!0),e.profile&&(t.profile=!0);else{if(t.totalItems=Object.keys(e).length-1,e.RockPaperBattle_achievements){const n=e.RockPaperBattle_achievements;t.achievements=Object.values(n).filter(s=>s.unlocked).length}e.RockPaperBattle_stats&&(t.stats=!0),e.RockPaperBattle_profile&&(t.profile=!0)}return t}let w=null;function dn(){fo()}function fo(){const e=document.getElementById("loading-bar"),t=document.getElementById("loading-text");mn(n=>{e&&(e.style.width=`${n}%`),t&&(t.textContent=`Loading game assets: ${n}%`)},()=>{t&&(t.textContent="Ready to play!"),setTimeout(mo,500)})}function mo(){const e=document.getElementById("loading-screen");e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500)),x("landing-page"),ot(),ks(),Is(),bn(),Sn(),gt(),On(),Os(),Un(),Jn(),Zs(),_s(),Ks(!1),go(),yo(),vo(),po(),ho()}function go(){fn({startEndlessMode:()=>{w="endless",je("endless"),cs(),i("click"),Qe("Endless")},backToMenu:()=>{w==="endless"?fs():w==="bestOf5"&&Es(),ee(),$(),w=null,je(null)},playAgain:()=>{w==="endless"?ms():w==="bestOf5"&&bs(),ee()},makeMove:b=>{$(),w==="endless"?$e(b):w==="bestOf5"&&tt(b),L()}});const e=document.getElementById("best-of-5-btn");e&&e.addEventListener("click",()=>{w="bestOf5",je("bestOf5"),hs(),i("click"),Qe("Best of 5");const b=document.getElementById("game-info-banner");b&&b.classList.add("hidden")});const t=document.getElementById("reset-scores");t&&t.addEventListener("click",()=>{w==="endless"?gs():w==="bestOf5"&&ws(),ee()});const n=document.getElementById("sound-toggle");n&&n.addEventListener("click",at);const s=document.getElementById("stats-btn");s&&s.addEventListener("click",()=>{Pt(),Mn()});const o=document.getElementById("back-from-stats");o&&o.addEventListener("click",Bn);const a=document.getElementById("reset-stats-btn");a&&a.addEventListener("click",()=>{confirm("Are you sure you want to reset all stats and achievements?")&&(Xe(),Ke(),Ze(),Pt(),i("click"))});const l=document.getElementById("settings-btn");l&&l.addEventListener("click",ln);const u=document.getElementById("fire-move-btn");u&&u.addEventListener("click",()=>{$();const b=u.getAttribute("data-move");w==="endless"?$e(b):w==="bestOf5"&&tt(b),L()});const y=document.getElementById("fps-toggle");y&&y.addEventListener("change",()=>{cn(),i("click")});const v=document.getElementById("export-data-btn");v&&v.addEventListener("click",()=>{no(),i("click")});const U=document.getElementById("import-data-file");U&&U.addEventListener("change",b=>{const ie=b.target.files[0];ie&&ao(ie).then(F=>{alert(`Import successful! Imported ${F.stats.totalItems} items including ${F.stats.achievements} achievements.`),window.location.reload()}).catch(F=>{alert(`Import failed: ${F.message}`)})}),document.addEventListener("click",L),document.addEventListener("mousemove",L),document.addEventListener("keydown",L)}function ho(){document.addEventListener("keydown",e=>{const t=document.getElementById("game-screen");if(t&&!t.classList.contains("hidden")&&(e.key==="Enter"||e.key===" ")&&document.activeElement.classList.contains("move-btn")){e.preventDefault();const n=document.activeElement.getAttribute("data-move");n&&($(),w==="endless"?$e(n):w==="bestOf5"&&tt(n),L())}if(e.key==="Enter"||e.key===" "){if(document.activeElement.classList.contains("avatar-option")){e.preventDefault();const n=document.activeElement.getAttribute("data-avatar");n&&nn(n)}if(document.activeElement.classList.contains("theme-option")){e.preventDefault();const n=document.activeElement.getAttribute("data-theme");n&&vt(n)}}})}function po(){window.showWinAnimation=function(){if(Be())return;const e=document.querySelector(".confetti-container");if(!e)return;e.innerHTML="";const t=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"];for(let n=0;n<50;n++){const s=document.createElement("div");s.className="confetti-piece",s.style.left=`${Math.random()*100}%`,s.style.top=`${Math.random()*50}%`,s.style.backgroundColor=t[Math.floor(Math.random()*t.length)],s.style.setProperty("--confetti-dx",`${(Math.random()-.5)*300}px`),s.style.setProperty("--confetti-rotate",`${Math.random()*360}deg`),e.appendChild(s)}setTimeout(()=>{e.innerHTML=""},2e3)},window.showLossAnimation=function(e){!e||Be()||(e.classList.add("shake-effect"),setTimeout(()=>{e.classList.remove("shake-effect")},500))},window.showDrawAnimation=function(e){!e||Be()||(e.classList.add("draw-effect"),setTimeout(()=>{e.classList.remove("draw-effect")},1e3))}}function Pt(){const e=document.getElementById("achievements-list");if(!e)return;const t=kn();e.innerHTML="",t.forEach(n=>{const s=document.createElement("div");s.className=`achievement-item ${n.unlocked?"unlocked":"locked"}`,s.setAttribute("role","listitem");const o=n.unlocked?"Unlocked":"Locked";s.setAttribute("aria-label",`${n.name} - ${o} - ${n.description}`),s.innerHTML=`
            <div class="achievement-icon">${n.icon}</div>
            <div class="achievement-content">
                <h4>${n.name}</h4>
                <p>${n.description}</p>
            </div>
        `,e.appendChild(s)})}function yo(){r()}function vo(){r("hasRunBefore")||(c("hasRunBefore",!0),setTimeout(()=>{ln()},1e3))}function Eo(){Gn();const e=document.getElementById("game-info-banner");e&&e.classList.add("hidden"),A()}window.addEventListener("DOMContentLoaded",dn);window.addEventListener("beforeunload",Eo);(document.readyState==="interactive"||document.readyState==="complete")&&dn();
