(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const Kt={rock:"✊",paper:"✋",scissors:"✌️",fire:"🔥"};function It(e,t){return e===t?"draw":e==="rock"&&t==="scissors"||e==="paper"&&t==="rock"||e==="scissors"&&t==="paper"?"win":e==="fire"?t==="scissors"||t==="paper"?"win":"lose":t==="fire"?e==="scissors"||e==="paper"?"lose":"win":"lose"}function Q(e){return Kt[e]||"❓"}function Lt(e,t,n){const s=Q(t),o=Q(n);return e==="win"?t==="fire"&&(n==="scissors"||n==="paper")?`${s} Fire burns ${o}! You win!`:t==="rock"&&n==="fire"?`${s} Rock smothers ${o}! You win!`:`${s} beats ${o}! You win!`:e==="lose"?n==="fire"&&(t==="scissors"||t==="paper")?`${o} Fire burns ${s}! You lose!`:n==="rock"&&t==="fire"?`${o} Rock smothers ${s}! You lose!`:`${o} beats ${s}! You lose!`:`${s} ties with ${o}! It's a draw!`}const u={landingPage:document.getElementById("landing-page"),gameScreen:document.getElementById("game-screen"),resultsScreen:document.getElementById("results-screen"),endlessModeBtn:document.getElementById("endless-mode-btn"),bestOf5Btn:document.getElementById("best-of-5-btn"),backToMenuBtn:document.getElementById("back-to-menu"),backToMenuResultBtn:document.getElementById("back-to-menu-btn"),playAgainBtn:document.getElementById("play-again-btn"),moveButtons:document.querySelectorAll(".move-btn"),themeToggleBtn:document.getElementById("theme-toggle-btn"),resetScoresBtn:document.getElementById("reset-scores"),soundToggleBtn:document.getElementById("sound-toggle"),playerScore:document.getElementById("player-score"),aiScore:document.getElementById("ai-score"),playerMoveDisplay:document.getElementById("player-move-display"),aiMoveDisplay:document.getElementById("ai-move-display"),resultTitle:document.getElementById("result-title"),resultMessage:document.getElementById("result-message"),playerMoveResult:document.getElementById("player-move"),aiMoveResult:document.getElementById("ai-move")};function O(e){u.landingPage.classList.add("hidden"),u.gameScreen.classList.add("hidden"),u.resultsScreen.classList.add("hidden");const t=document.getElementById(e);t?t.classList.remove("hidden"):console.error("Invalid section ID:",e)}function ce(e,t){u.playerScore.textContent=e,u.aiScore.textContent=t}function Ce(e,t){u.playerMoveDisplay.textContent=Q(e),u.aiMoveDisplay.textContent=Q(t)}function Bt(e,t,n,s){let o,i;switch(e){case"win":o="You Win!",i="win";break;case"lose":o="You Lose!",i="lose";break;case"draw":o="It's a Draw!",i="draw";break;default:o="Game Result",i=""}u.resultTitle.textContent=o,u.resultMessage.textContent=t,u.resultMessage.className=`result-message ${i}`,u.playerMoveResult.textContent=Q(n),u.aiMoveResult.textContent=Q(s),O("results-screen")}function Qt(e){e.startEndlessMode&&u.endlessModeBtn&&u.endlessModeBtn.addEventListener("click",e.startEndlessMode),e.backToMenu&&(u.backToMenuBtn&&u.backToMenuBtn.addEventListener("click",e.backToMenu),u.backToMenuResultBtn&&u.backToMenuResultBtn.addEventListener("click",e.backToMenu)),e.playAgain&&u.playAgainBtn&&u.playAgainBtn.addEventListener("click",e.playAgain),e.makeMove&&u.moveButtons&&u.moveButtons.forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-move");e.makeMove(n)})}),e.toggleTheme&&u.themeToggleBtn&&u.themeToggleBtn.addEventListener("click",e.toggleTheme),e.resetScores&&u.resetScoresBtn&&u.resetScoresBtn.addEventListener("click",e.resetScores)}const Ze="rock-paper-battle",He={theme:"day",soundEnabled:!0,soundVolume:.5,ambientEnabled:!0,ambientVolume:.3,audioStyle:"retro",stats:{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""},achievements:{winStreak3:!1,flawlessVictory:!1,roundsPlayed10:!1},profile:{name:"Player",avatar:"👤"},unlocks:{secretMoveUnlocked:!1,secretMoveRevealed:!1},currentWinStreak:0};let V=null;function l(e=null){if(!V)try{const t=localStorage.getItem(Ze);V=t?JSON.parse(t):{...He}}catch(t){console.error("Error loading data from localStorage:",t),V={...He}}return e?V[e]:V}function a(e,t){const n=l();n[e]=t;try{localStorage.setItem(Ze,JSON.stringify(n)),V=n}catch(s){console.error("Error saving data to localStorage:",s)}}function me(e){if(!["wins","losses","draws"].includes(e)){console.error(`Invalid stat name: ${e}`);return}const t=l("stats")||{};t[e]=(t[e]||0)+1,a("stats",t)}function Mt(){try{localStorage.removeItem(Ze),V={...He}}catch(e){console.error("Error clearing data from localStorage:",e)}}const Zt={click:"click.wav",win:"win.wav",lose:"lose.wav",draw:"draw.wav",gameStart:"gameStart.wav",gameLose:"gameLose.wav",gameWin:"gameWin.wav",gameDraw:"gameDraw.wav",countdown:"countdown.wav",tick:"tick.wav",timeUp:"timeUp.wav",bonusRound:"bonusRound.wav",chaos:"chaos.wav"},At={wind:"wind.wav",hum:"hum.wav",lofi:"lo-fi-loop.wav"},_e={},je={},fe={},ge={};let y=!0,C=!0,Z=.5,U=.3,p=null,_="retro";function Xt(){y=l("soundEnabled")!==!1,C=l("ambientEnabled")!==!1,_=l("audioStyle")||"retro";const e=l("soundVolume");e!=null&&(Z=parseFloat(e));const t=l("ambientVolume");t!=null&&(U=parseFloat(t)),Xe(),en(),y&&C&&setTimeout(()=>{D()},1e3),console.log("Sound settings initialized:",{soundEnabled:y,ambientEnabled:C,volume:Z,ambientVolume:U,audioStyle:_})}function en(){Object.entries(Zt).forEach(([e,t])=>{_e[e]=new Audio(`./audio/retro/${t}`),_e[e].load(),je[e]=new Audio(`./audio/modern/${t}`),je[e].load()}),Object.entries(At).forEach(([e,t])=>{fe[e]=new Audio(`./audio/retro/ambient/${t}`),fe[e].loop=!0,fe[e].load(),ge[e]=new Audio(`./audio/modern/ambient/${t}`),ge[e].loop=!0,ge[e].load()})}function Xe(){const e=document.getElementById("sound-toggle");e&&(e.textContent=y?"🔊":"🔇",e.title=y?"Sound On (Click to Mute)":"Sound Off (Click to Unmute)")}function c(e){if(!y)return;const n=(_==="retro"?_e:je)[e];if(!n)return;const s=n.cloneNode();s.volume=Z,s.play().catch(o=>console.warn("Error playing sound:",o))}function D(e="lofi"){!y||!C||($(),p=(_==="retro"?fe:ge)[e],!p)||(p=p.cloneNode(),p.volume=U,p.loop=!0,p.play().catch(n=>console.warn("Error playing ambient sound:",n)))}function $(){p&&(p.pause(),p.currentTime=0,p=null)}function tn(){y=!y,a("soundEnabled",y),Xe(),y?(c("click"),C&&D()):$()}function Pe(e){console.log("setSoundEnabled called with:",e),y=e,a("soundEnabled",e),Xe(),e?C&&D():$()}function De(){return y}function ft(e){console.log("setAmbientEnabled called with:",e),C=e,a("ambientEnabled",e),e?y&&D():$()}function nn(){return C}function sn(e){Z=Math.max(0,Math.min(1,e)),a("soundVolume",Z)}function on(){return Z}function cn(e){U=Math.max(0,Math.min(1,e)),a("ambientVolume",U),p&&(p.volume=U)}function an(){return U}function gt(e){if(e!=="modern"&&e!=="retro")return;if(_=e,a("audioStyle",_),p!==null){const n=rn();$(),y&&C&&D(n)}}function rn(){if(!p)return"lofi";for(const[e,t]of Object.entries(At))if(p.src.includes(t))return e;return"lofi"}function ln(){return _}const qe={winStreak3:{id:"winStreak3",name:"3 Wins in a Row",description:"Win 3 games in a row",icon:"🥉"},flawlessVictory:{id:"flawlessVictory",name:"Flawless Victory",description:"Win all rounds in a Best of 5 match",icon:"🥇"},roundsPlayed10:{id:"roundsPlayed10",name:"10 Total Rounds Played",description:"Play 10 or more rounds",icon:"📊"}};let G=0;function dn(){l("achievements")||a("achievements",{winStreak3:!1,flawlessVictory:!1,roundsPlayed10:!1}),G=l("currentWinStreak")||0}function et(e,t={},n="endless"){e==="win"?G++:e==="lose"&&(G=0),a("currentWinStreak",G),G>=3&&Ne("winStreak3"),n==="bestOf5"&&t.gameOver&&t.playerScore>=3&&t.aiScore===0&&Ne("flawlessVictory");const s=l("stats");(s.wins||0)+(s.losses||0)+(s.draws||0)>=10&&Ne("roundsPlayed10")}function Ne(e){if(!qe[e]){console.error(`Achievement "${e}" does not exist`);return}const t=l("achievements");t[e]||(t[e]=!0,a("achievements",t),c("win"),un(qe[e]))}function un(e){const t=document.createElement("div");t.className="achievement-notification",t.innerHTML=`
        <div class="achievement-icon">${e.icon}</div>
        <div class="achievement-content">
            <h3>Achievement Unlocked!</h3>
            <p class="achievement-name">${e.name}</p>
            <p class="achievement-description">${e.description}</p>
        </div>
    `,document.body.appendChild(t),setTimeout(()=>{t.classList.add("show")},100),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{document.body.removeChild(t)},500)},5e3)}function mn(){const e=l("achievements")||{};return Object.values(qe).map(t=>({...t,unlocked:e[t.id]||!1}))}function Ye(){a("achievements",{winStreak3:!1,flawlessVictory:!1,roundsPlayed10:!1}),G=0,a("currentWinStreak",0)}function fn(){l("stats")||a("stats",{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""})}function Rt(e){const t=l("stats");e>t.longestWinStreak&&(t.longestWinStreak=e,a("stats",t))}function Ge(e){const t=l("stats");t.bestMode=e,a("stats",t)}function Ct(){const e=l("stats")||{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:"None"},t=document.getElementById("stats-wins"),n=document.getElementById("stats-losses"),s=document.getElementById("stats-draws"),o=document.getElementById("stats-streak"),i=document.getElementById("stats-best-mode"),r=document.getElementById("stats-win-rate"),m=document.getElementById("stats-total-games");t&&(t.textContent=e.wins),n&&(n.textContent=e.losses),s&&(s.textContent=e.draws),o&&(o.textContent=e.longestWinStreak),i&&(i.textContent=e.bestMode||"None");const b=e.wins+e.losses+e.draws,v=b>0?Math.round(e.wins/b*100):0;r&&(r.textContent=`${v}%`),m&&(m.textContent=b),gn(e,b)}function gn(e,t){const n=document.getElementById("stats-wins-bar"),s=document.getElementById("stats-losses-bar"),o=document.getElementById("stats-draws-bar");if(!n||!s||!o)return;const i=t>0?Math.max(2,e.wins/t*100):2,r=t>0?Math.max(2,e.losses/t*100):2,m=t>0?Math.max(2,e.draws/t*100):2;n.style.width=`${i}%`,s.style.width=`${r}%`,o.style.width=`${m}%`}function ze(){a("stats",{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""}),Ct(),c("click")}function hn(){document.getElementById("landing-page").classList.add("hidden"),document.getElementById("game-screen").classList.add("hidden"),document.getElementById("results-screen").classList.add("hidden"),document.getElementById("stats-screen").classList.remove("hidden"),Ct(),c("click")}function pn(){document.getElementById("stats-screen").classList.add("hidden"),document.getElementById("landing-page").classList.remove("hidden"),c("click")}const vn=10;let ee=!1;function tt(){ee=(l("unlocks")||{}).secretMoveUnlocked||!1,En(),nt()}function En(){if(ee)return;((l("stats")||{}).wins||0)>=vn&&yn()}function yn(){ee=!0;const e=l("unlocks")||{};e.secretMoveUnlocked=!0,a("unlocks",e),nt(),setTimeout(bn,1e3)}function nt(){const e=document.getElementById("fire-move-btn");if(e)if(ee){e.classList.remove("hidden");const t=l("unlocks")||{};t.secretMoveUnlocked&&!t.secretMoveRevealed&&(e.classList.add("fire-reveal"),t.secretMoveRevealed=!0,a("unlocks",t),setTimeout(()=>{e.classList.add("fire-glow"),setTimeout(()=>{e.classList.remove("fire-glow")},5e3)},1e3))}else e.classList.add("hidden")}function bn(){const e=document.createElement("div");e.className="achievement-notification",e.innerHTML=`
        <div class="achievement-icon">🔥</div>
        <div class="achievement-content">
            <h3>New Move Unlocked!</h3>
            <p class="achievement-name">Fire Move</p>
            <p class="achievement-description">You've unlocked the secret Fire move!</p>
        </div>
    `,document.body.appendChild(e),c("win"),setTimeout(()=>{e.classList.add("show")},100),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{document.body.removeChild(e)},500)},5e3)}function ae(){return ee}function Je(){ee=!1;const e=l("unlocks")||{};e.secretMoveUnlocked=!1,e.secretMoveRevealed=!1,a("unlocks",e),nt()}const w={RANDOM:"random",CHEEKY:"cheeky",PREDICTIVE:"predictive"};let te=w.RANDOM;const x={rock:0,paper:0,scissors:0,fire:0};let oe=null;function kn(){const e=l("aiMode");e&&Object.values(w).includes(e)?te=e:a("aiMode",w.RANDOM),Te()}function Te(){x.rock=0,x.paper=0,x.scissors=0,x.fire=0,oe=null}function Tt(e){x[e]!==void 0&&(x[e]++,oe=e)}function $t(e){switch(te){case w.CHEEKY:return wn(e);case w.PREDICTIVE:return Sn(e);case w.RANDOM:default:return re(e)}}function re(e){const t=Math.floor(Math.random()*e.length);return e[t]}function wn(e){return oe&&e.includes(oe)&&Math.random()<.4?oe:re(e)}function Sn(e){let t="rock",n=0;for(const[i,r]of Object.entries(x))r>n&&(n=r,t=i);if(Object.values(x).reduce((i,r)=>i+r,0)<3)return re(e);let o;switch(t){case"rock":o="paper";break;case"paper":o="scissors";break;case"scissors":o="rock";break;case"fire":o="rock";break;default:o="rock"}return e.includes(o)?o:re(e)}function In(e){Object.values(w).includes(e)?(te=e,a("aiMode",e),Te()):console.error(`Invalid AI mode: ${e}`)}function X(){return te}function Ot(){switch(te){case w.CHEEKY:return"Cheeky";case w.PREDICTIVE:return"Predictive";case w.RANDOM:default:return"Random"}}function xt(){switch(te){case w.CHEEKY:return"😏";case w.PREDICTIVE:return"🧠";case w.RANDOM:default:return"🤖"}}const Pt=3e3,Dt=50,Ln=1e3;let le=!1,he=null,pe=null,q=0,ve=null,I=null,Se=!1;function Bn(){const e=l("speedMode");e!==void 0?le=e:(a("speedMode",!1),le=!1),Mn()}function Mn(){if(document.getElementById("speed-timer")){I=document.getElementById("speed-timer");return}const e=document.createElement("div");e.id="speed-timer-container",e.className="speed-timer-container hidden",I=document.createElement("div"),I.id="speed-timer",I.className="speed-timer",e.appendChild(I);const t=document.getElementById("game-screen");if(t){const n=t.querySelector(".game-header");n?n.insertAdjacentElement("afterend",e):t.insertAdjacentElement("afterbegin",e)}else document.body.appendChild(e)}function ne(){return le}function An(e){le=e,a("speedMode",e)}function Rn(e=Pt,t=null){if(!le||Se)return!1;ve=t,q=e,Se=!0;const n=document.getElementById("speed-timer-container");return n&&n.classList.remove("hidden"),I&&(I.style.width="100%",I.classList.remove("warning")),H(),he=setTimeout(()=>{Cn()},e),pe=setInterval(()=>{Tn()},Dt),c("countdown"),!0}function H(){he&&(clearTimeout(he),he=null),pe&&(clearInterval(pe),pe=null),Se=!1;const e=document.getElementById("speed-timer-container");e&&e.classList.add("hidden")}function Cn(){c("timeUp"),ve&&typeof ve=="function"&&ve(),H()}function Tn(){if(!I||!Se)return;q-=Dt,q<0&&(q=0);const e=q/Pt*100;I.style.width=`${e}%`,q<=Ln&&!I.classList.contains("warning")&&(I.classList.add("warning"),c("tick"))}function $n(e){return re(e)}const On=.2,T={DOUBLE_POINTS:"double-points",REVERSE_RULES:"reverse-rules",CHAOS_MODE:"chaos-mode"};let $e=!0,R=null,ie={};function xn(){const e=l("bonusEnabled");e!==void 0?$e=e:a("bonusEnabled",!0)}function Nt(){return $e}function Pn(e){$e=e,a("bonusEnabled",e)}function Dn(){return $e?Math.random()<On:!1}function Nn(){R&&z();const e=Object.values(T),t=Math.floor(Math.random()*e.length),n=e[t];return Fn(n),n}function Fn(e){if(!Object.values(T).includes(e)){console.error(`Invalid bonus type: ${e}`);return}R=e,Vn(e),Hn(e),c("bonusRound")}function Vn(e){const t=document.querySelector(".game-area");switch(t&&(t.classList.add("bonus-round"),t.classList.add(e)),e){case T.CHAOS_MODE:Wn();break}}function Wn(){const e=document.querySelectorAll(".move-btn:not(.hidden)");if(e.length<2)return;ie={},e.forEach(n=>{const s=n.getAttribute("data-move");ie[s]=n.textContent}),Array.from(e).map(n=>n.getAttribute("data-move"));const t=Array.from(e).map(n=>n.textContent);for(let n=t.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[t[n],t[s]]=[t[s],t[n]]}e.forEach((n,s)=>{n.textContent=t[s],n.classList.add("chaos-mode-btn")}),c("chaos")}function z(){if(!R)return;const e=document.querySelector(".game-area");switch(e&&(e.classList.remove("bonus-round"),e.classList.remove(R)),R){case T.CHAOS_MODE:Un();break}R=null}function Un(){document.querySelectorAll(".move-btn").forEach(t=>{const n=t.getAttribute("data-move");ie[n]&&(t.textContent=ie[n]),t.classList.remove("chaos-mode-btn")}),ie={}}function Hn(e){let t,n,s;switch(e){case T.DOUBLE_POINTS:t="Double Points Round!",n="Win this round to earn double points!",s="🎯";break;case T.REVERSE_RULES:t="Reverse Rules!",n="The rules are reversed! Rock beats Paper, Paper beats Scissors, Scissors beats Rock!",s="🔁";break;case T.CHAOS_MODE:t="Chaos Mode!",n="Move labels are scrambled! Choose wisely!",s="🎲";break;default:t="Bonus Round!",n="Special rules apply this round!",s="🎁"}const o=document.createElement("div");o.className="bonus-notification",o.innerHTML=`
        <div class="bonus-notification-icon">${s}</div>
        <div class="bonus-notification-content">
            <h3>${t}</h3>
            <p>${n}</p>
        </div>
    `,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{document.body.removeChild(o)},500)},4e3)}function _n(e,t,n){if(!R)return e;switch(R){case T.REVERSE_RULES:return jn(e,t,n);default:return e}}function jn(e,t,n){if(t===n)return"draw";if(t==="rock"&&n==="paper"||t==="paper"&&n==="scissors"||t==="scissors"&&n==="rock")return"win";if(t==="paper"&&n==="rock"||t==="scissors"&&n==="paper"||t==="rock"&&n==="scissors")return"lose";if(t==="fire"){if(n==="scissors"||n==="paper")return"win";if(n==="rock")return"lose"}if(n==="fire"){if(t==="scissors"||t==="paper")return"lose";if(t==="rock")return"win"}return e}function qn(){return R===T.DOUBLE_POINTS?2:1}const g={playerScore:0,aiScore:0,currentRound:0,lastPlayerMove:null,lastAiMove:null,lastResult:null,bonusRoundActive:!1,bonusType:null,timeoutMove:null};function Yn(){Ft(),document.querySelector("#game-screen h2").textContent="Endless Mode",Gn();const e=l("stats");e?ce(e.wins,e.losses):ce(0,0),O("game-screen"),c("gameStart"),ne()&&st()}function st(){ne()&&Rn(3e3,()=>{const t=ae()?["rock","paper","scissors","fire"]:["rock","paper","scissors"],n=$n(t);g.timeoutMove=n,Ie(n,!0)})}function Gn(){const e=document.getElementById("ai-mode-indicator");if(e){e.className="ai-mode-indicator",e.textContent=xt();const t=X();t==="random"?e.classList.add("ai-random-indicator"):t==="cheeky"?e.classList.add("ai-cheeky-indicator"):t==="predictive"&&e.classList.add("ai-predictive-indicator"),e.title=`${Ot()} AI Mode`}}function Ft(){g.currentRound=0,g.lastPlayerMove=null,g.lastAiMove=null,g.lastResult=null,g.bonusRoundActive=!1,g.bonusType=null,g.timeoutMove=null,Ce("",""),Te(),z()}function Ie(e,t=!1){Tt(e),!g.bonusRoundActive&&Nt()&&Dn()&&(g.bonusRoundActive=!0,g.bonusType=Nn());const s=ae()?["rock","paper","scissors","fire"]:["rock","paper","scissors"],o=$t(s);let i=It(e,o);g.bonusRoundActive&&(i=_n(i,e,o)),g.lastPlayerMove=e,g.lastAiMove=o,g.lastResult=i,g.currentRound++,Ce(e,o),Jn(i,t),c(i==="win"?"win":i==="lose"?"lose":"draw"),et(i,g,"endless"),ae()||tt();const r=Lt(i,e,o);zn(i),setTimeout(()=>{Bt(i,r,e,o),g.bonusRoundActive&&(z(),g.bonusRoundActive=!1,g.bonusType=null)},1e3)}function zn(e){const t=document.getElementById("player-move-display"),n=document.getElementById("ai-move-display");switch(e){case"win":window.showWinAnimation&&window.showWinAnimation();break;case"lose":window.showLossAnimation&&t&&window.showLossAnimation(t);break;case"draw":window.showDrawAnimation&&t&&n&&(window.showDrawAnimation(t),window.showDrawAnimation(n));break}}function Jn(e,t){const n=g.bonusRoundActive?qn():1;if(t&&e!=="win"&&(e="lose"),e==="win")for(let o=0;o<n;o++)me("wins");else me(e==="lose"?"losses":"draws");g.bonusRoundActive&&e==="win"&&Kn();const s=l("stats");if(ce(s.wins,s.losses),e==="win"){const o=l("currentWinStreak")||0;Rt(o)}Qn(e)}function Kn(){const e=l("bonusRoundsWon")||0;a("bonusRoundsWon",e+1);const t=document.getElementById("stats-bonus-rounds");t&&(t.textContent=e+1)}function Qn(e){if(e!=="win")return;const t=X(),n=l("aiStats")||{random:{wins:0},cheeky:{wins:0},predictive:{wins:0}};n[t]||(n[t]={wins:0}),n[t].wins=(n[t].wins||0)+1,a("aiStats",n);const s=document.getElementById("stats-best-ai-mode");if(s){let o="random",i=0;for(const[b,v]of Object.entries(n))v.wins>i&&(i=v.wins,o=b);let r="Random",m="🤖";switch(o){case"cheeky":r="Cheeky",m="😏";break;case"predictive":r="Predictive",m="🧠";break;default:r="Random",m="🤖";break}s.textContent=`${m} ${r}`}}function Zn(){c("click"),O("landing-page"),H()}function Xn(){c("click"),O("game-screen"),ne()&&st()}function es(){const e=l();e.stats.wins=0,e.stats.losses=0,e.stats.draws=0,a("stats",e.stats),ce(0,0),Ft(),a("currentWinStreak",0),c("click"),ne()&&st()}const d={playerScore:0,aiScore:0,currentRound:0,maxRounds:5,lastPlayerMove:null,lastAiMove:null,lastResult:null,gameOver:!1};function ts(){ot(),document.querySelector("#game-screen h2").textContent="Best of 5",ns(),O("game-screen"),c("gameStart")}function ns(){const e=document.getElementById("ai-mode-indicator");if(e){e.className="ai-mode-indicator",e.textContent=xt();const t=X();t==="random"?e.classList.add("ai-random-indicator"):t==="cheeky"?e.classList.add("ai-cheeky-indicator"):t==="predictive"&&e.classList.add("ai-predictive-indicator"),e.title=`${Ot()} AI Mode`}}function ot(){d.playerScore=0,d.aiScore=0,d.currentRound=0,d.lastPlayerMove=null,d.lastAiMove=null,d.lastResult=null,d.gameOver=!1,Ce("",""),Vt(),Te()}function Vt(){ce(d.playerScore,d.aiScore)}function Ke(e){if(d.gameOver)return;Tt(e);const n=ae()?["rock","paper","scissors","fire"]:["rock","paper","scissors"],s=$t(n),o=It(e,s);d.lastPlayerMove=e,d.lastAiMove=s,d.lastResult=o,d.currentRound++,o==="win"?(d.playerScore++,c("win")):o==="lose"?(d.aiScore++,c("lose")):c("draw"),Vt(),Ce(e,s);const i=Lt(o,e,s),r=os();if(et(o,d,"bestOf5"),ae()||tt(),setTimeout(()=>{r?is():Bt(o,i,e,s)},1e3),me(o==="win"?"wins":o==="lose"?"losses":"draws"),o==="win"){const m=l("currentWinStreak")||0;Rt(m),ss(o)}}function ss(e){if(e!=="win")return;const t=X(),n=l("aiStats")||{random:{wins:0},cheeky:{wins:0},predictive:{wins:0}};n[t]||(n[t]={wins:0}),n[t].wins=(n[t].wins||0)+1,a("aiStats",n);const s=document.getElementById("stats-best-ai-mode");if(s){let o="random",i=0;for(const[b,v]of Object.entries(n))v.wins>i&&(i=v.wins,o=b);let r="Random",m="🤖";switch(o){case"cheeky":r="Cheeky",m="😏";break;case"predictive":r="Predictive",m="🧠";break;default:r="Random",m="🤖";break}s.textContent=`${m} ${r}`}}function os(){return d.playerScore>=3||d.aiScore>=3||d.currentRound>=d.maxRounds?(d.gameOver=!0,!0):!1}function is(){const e=d.playerScore>d.aiScore,t=d.playerScore===d.aiScore;let n,s,o;t?(n="It's a Draw!",s=`Final Score: ${d.playerScore}-${d.aiScore}`,o="draw",c("gameDraw")):e?(n="You Win the Match!",s=`Final Score: ${d.playerScore}-${d.aiScore}`,o="win",c("gameWin"),Ge("Best of 5"),d.aiScore===0&&et("win",d,"bestOf5")):(n="You Lose the Match!",s=`Final Score: ${d.playerScore}-${d.aiScore}`,o="lose",c("gameLose"));const i=document.getElementById("result-title"),r=document.getElementById("result-message");i.textContent=n,r.textContent=s,r.className=`result-message ${o}`,O("results-screen")}function cs(){c("click"),O("landing-page")}function as(){c("click"),d.gameOver&&ot(),O("game-screen")}function rs(){ot(),c("click")}const Oe=["day","night","retro","neon"];let Le="day";function ls(){const e=l("theme");e&&Oe.includes(e)&&(Le=e),Wt(Le)}function ds(){document.querySelectorAll(".theme-option").forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-theme");n&&Oe.includes(n)&&(it(n),ht(n),c("click"))})}),ht(Le)}function ht(e){document.querySelectorAll(".theme-option").forEach(s=>{s.classList.remove("active")});const n=document.querySelector(`.theme-option[data-theme="${e}"]`);n&&n.classList.add("active")}function it(e){if(!Oe.includes(e)){console.error(`Theme "${e}" is not valid`);return}Le=e,a("theme",e),Wt(e)}function Wt(e){document.body.classList.remove(...Oe.map(t=>`theme-${t}`)),document.body.classList.add(`theme-${e}`)}const ct={name:"Player",avatar:"👤"};let M={...ct};function us(){const e=l("profile");e?M=e:a("profile",ct),at()}function ms(){document.querySelectorAll(".avatar-option").forEach(s=>{s.addEventListener("click",()=>{const o=s.getAttribute("data-avatar");o&&(Ut(o),pt(o),c("click"))})});const t=document.getElementById("player-name-input");t&&(t.value=M.name);const n=document.getElementById("save-profile-btn");n&&n.addEventListener("click",fs),pt(M.avatar)}function pt(e){document.querySelectorAll(".avatar-option").forEach(s=>{s.classList.remove("selected")});const n=document.querySelector(`.avatar-option[data-avatar="${e}"]`);n&&(n.classList.add("selected"),n.classList.add("avatar-highlight"),setTimeout(()=>{n.classList.remove("avatar-highlight")},500))}function Ut(e){M.avatar=e}function fs(){const e=document.getElementById("player-name-input");e&&e.value.trim()&&(M.name=e.value.trim()),a("profile",M),at(),c("win"),gs()}function gs(){const e=document.getElementById("save-profile-btn");if(e){const t=e.textContent;e.textContent="Saved!",e.disabled=!0,setTimeout(()=>{e.textContent=t,e.disabled=!1},1500)}}function at(){const e=document.getElementById("player-avatar"),t=document.getElementById("player-name");e&&(e.textContent=M.avatar),t&&(t.textContent=M.name);const n=document.getElementById("game-player-avatar"),s=document.getElementById("game-player-name");n&&(n.textContent=M.avatar),s&&(s.textContent=M.name)}function hs(){M={...ct},a("profile",M),at()}const ps=7e3,vs=1e3;let Fe=null,xe=!1,Ht=Date.now(),J=[];const Es=[".move-btn",".player-choice",".ai-choice"];function ys(){bs(),ks()}function bs(){document.addEventListener("mousemove",A),document.addEventListener("click",A),document.addEventListener("keydown",A),document.addEventListener("touchstart",A),document.addEventListener("touchmove",A)}function ks(){Fe&&clearInterval(Fe),Fe=setInterval(ws,vs)}function A(){Ht=Date.now(),xe&&Is()}function ws(){Date.now()-Ht>=ps&&!xe&&Ss()}function Ss(){xe=!0,Ls(),Bs(),l("ambientEnabled")!==!1&&D()}function Is(){xe=!1,Ms(),$()}function Ls(){J=[],Es.forEach(t=>{document.querySelectorAll(t).forEach(s=>{s.offsetParent!==null&&J.push(s)})});const e=document.querySelector("section:not(.hidden)");e&&J.push(e)}function Bs(){J.forEach((e,t)=>{e.classList.contains("idle-animation")||(e.classList.contains("move-btn")?(e.classList.add("idle-animation","idle-pulse"),e.style.animationDelay=`${t*.2}s`):e.classList.contains("player-choice")||e.classList.contains("ai-choice")?e.classList.add("idle-animation","idle-glow"):e.tagName.toLowerCase()==="section"&&e.classList.add("idle-animation","idle-background"))}),document.body.classList.add("idle")}function Ms(){J.forEach(t=>{t.classList.remove("idle-animation","idle-pulse","idle-glow","idle-background"),t.style.animationDelay=""}),document.querySelectorAll(".idle-animation").forEach(t=>{t.classList.remove("idle-animation","idle-pulse","idle-glow","idle-background"),t.style.animationDelay=""}),document.body.classList.remove("idle"),J=[]}const vt="high-contrast",Et="reduced-motion";let L=!1,B=!1;function As(){Rs(),Cs(),Ts(),de(),console.log("Accessibility settings initialized:",{highContrast:L,reducedMotion:B})}function Rs(){window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(B=!0,a("reducedMotion",!0)),window.matchMedia("(prefers-contrast: more)").matches&&(L=!0,a("highContrast",!0))}function Cs(){const e=l("highContrast");e!==void 0&&(L=e);const t=l("reducedMotion");t!==void 0&&(B=t)}function Ts(){const e=document.getElementById("high-contrast-toggle");if(e){e.checked=L,e.addEventListener("change",s=>{Ve(s.target.checked)});const n=e.parentElement;n&&n.classList.contains("toggle-switch")&&n.addEventListener("click",s=>{s.target!==e&&(e.checked=!e.checked,Ve(e.checked))})}const t=document.getElementById("reduced-motion-toggle");if(t){t.checked=B,t.addEventListener("change",s=>{We(s.target.checked)});const n=t.parentElement;n&&n.classList.contains("toggle-switch")&&n.addEventListener("click",s=>{s.target!==t&&(t.checked=!t.checked,We(t.checked))})}window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",n=>{n.matches&&We(!0)}),window.matchMedia("(prefers-contrast: more)").addEventListener("change",n=>{n.matches&&Ve(!0)})}function de(){L?(document.body.classList.add(vt),console.log("High contrast mode enabled")):(document.body.classList.remove(vt),console.log("High contrast mode disabled")),B?(document.body.classList.add(Et),console.log("Reduced motion mode enabled")):(document.body.classList.remove(Et),console.log("Reduced motion mode disabled"))}function yt(){L=!L,a("highContrast",L),de();const e=document.getElementById("high-contrast-toggle");return e&&(e.checked=L),L}function bt(){B=!B,a("reducedMotion",B),de();const e=document.getElementById("reduced-motion-toggle");return e&&(e.checked=B),B}function Ve(e){L=e,a("highContrast",e),de();const t=document.getElementById("high-contrast-toggle");t&&(t.checked=e)}function We(e){B=e,a("reducedMotion",e),de();const t=document.getElementById("reduced-motion-toggle");t&&(t.checked=e)}function Ue(){return L}function K(){return B}const $s=1e3,Os=60;let P=!1,Be=null,h=null,Qe=0,Me=0,Y=[],kt=0,Ee=1/0,ye=0;function xs(e=!1){P=e,Ps(),P&&_t()}function Ps(){if(document.getElementById("fps-display")){h=document.getElementById("fps-display");return}h=document.createElement("div"),h.id="fps-display",h.className=P?"fps-display":"fps-display hidden",h.innerHTML=`
        <div class="fps-current">FPS: --</div>
        <div class="fps-avg">Avg: --</div>
        <div class="fps-range">Min: -- | Max: --</div>
    `;const e=document.createElement("style");e.textContent=`
        .fps-display {
            position: fixed;
            top: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            padding: 5px 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
            border-bottom-left-radius: 5px;
        }
        
        .fps-display.hidden {
            display: none;
        }
        
        .fps-current {
            font-weight: bold;
        }
        
        .fps-avg, .fps-range {
            font-size: 10px;
            opacity: 0.8;
        }
    `,document.head.appendChild(e),document.body.appendChild(h)}function _t(){h&&h.classList.remove("hidden"),Me=0,Y=[],Qe=performance.now(),Ee=1/0,ye=0,cancelAnimationFrame(Be),Be=requestAnimationFrame(jt),setInterval(Ds,$s)}function jt(e){Me++,Be=requestAnimationFrame(jt)}function Ds(){if(!P||!h)return;const e=performance.now(),t=e-Qe,n=Math.round(Me*1e3/t);Y.push(n),Y.length>Os&&Y.shift(),kt=Math.round(Y.reduce((s,o)=>s+o,0)/Y.length),Ee=Math.min(Ee,n),ye=Math.max(ye,n),h.querySelector(".fps-current").textContent=`FPS: ${n}`,h.querySelector(".fps-avg").textContent=`Avg: ${kt}`,h.querySelector(".fps-range").textContent=`Min: ${Ee} | Max: ${ye}`,Me=0,Qe=e,n<30?h.style.color="#ff0000":n<50?h.style.color="#ffff00":h.style.color="#00ff00"}function qt(){return P=!P,P?_t():(h&&h.classList.add("hidden"),cancelAnimationFrame(Be)),P}const ue={images:["logo.webp"],icons:["favicon-96x96.png","apple-touch-icon.png","favicon.svg","web-app-manifest-192x192.png","web-app-manifest-512x512.png"]};let Ae=0,be=0,ke=!1,we=null,W=null;function Ns(e=null,t=null){ke||(ke=!0,we=e,W=t,Ae=ue.images.length+ue.icons.length,be=0,ue.images.forEach(n=>{Fs(n)}),ue.icons.forEach(n=>{Vs(n)}),Ae===0&&(ke=!1,W&&typeof W=="function"&&W()))}function Fs(e){const t=new Image;t.onload=()=>{Re()},t.onerror=()=>{console.warn(`Failed to load image file: ${e}`),Re()},t.src=`./images/${e}`,e.split(".")[0]}function Vs(e){const t=new Image;t.onload=()=>{Re()},t.onerror=()=>{console.warn(`Failed to load icon file: ${e}`),Re()},t.src=`./icons/${e}`,e.split(".")[0]}function Re(e){be++;const t=Math.floor(be/Ae*100);we&&typeof we=="function"&&we(t),be>=Ae&&(ke=!1,W&&typeof W=="function"&&W())}function Ws(){Us()}function Us(){const e=document.getElementById("back-from-settings");e&&e.addEventListener("click",Hs);const t=document.querySelectorAll(".tab-btn");t.forEach(f=>{f.addEventListener("click",()=>{const j=f.getAttribute("data-tab");j&&(Gt(j),c("click"),t.forEach(mt=>{mt.setAttribute("aria-selected",mt===f)}))})}),ds(),ms();const n=document.getElementById("sound-toggle-setting");n&&(n.checked=De(),console.log("Sound toggle initialized:",n.checked),n.addEventListener("change",()=>{console.log("Sound toggle changed to:",n.checked),Pe(n.checked),n.checked&&c("click")}),n.parentElement.addEventListener("click",f=>{f.target!==n&&(n.checked=!n.checked,console.log("Sound toggle clicked (parent):",n.checked),Pe(n.checked),n.checked&&c("click"))}));const s=document.getElementById("sound-volume");s&&(s.value=on()*100,s.addEventListener("input",()=>{const f=s.value/100;sn(f),De()&&s.value>0&&c("tick")}));const o=document.getElementById("ambient-toggle-setting");o&&(o.checked=nn(),console.log("Ambient toggle initialized:",o.checked),o.addEventListener("change",()=>{console.log("Ambient toggle changed to:",o.checked),ft(o.checked),o.checked?(D(),c("click")):($(),c("click"))}),o.parentElement.addEventListener("click",f=>{f.target!==o&&(o.checked=!o.checked,console.log("Ambient toggle clicked (parent):",o.checked),ft(o.checked),o.checked?(D(),c("click")):($(),c("click")))}));const i=document.getElementById("ambient-volume");i&&(i.value=an()*100,i.addEventListener("input",()=>{const f=i.value/100;cn(f),De()&&i.value>0&&c("tick")}));const r=document.getElementById("sound-style-retro"),m=document.getElementById("sound-style-modern");if(r&&m){const f=ln();r.checked=f==="retro",m.checked=f==="modern",r.addEventListener("change",()=>{r.checked&&(gt("retro"),c("click"))}),m.addEventListener("change",()=>{m.checked&&(gt("modern"),c("click"))})}const b=document.getElementById("test-sound-btn");b&&b.addEventListener("click",()=>{c("win")});const v=document.getElementById("ai-mode-select");v&&(v.value=X(),wt(X()),v.addEventListener("change",()=>{const f=v.value;In(f),wt(f),c("click")}));const N=document.getElementById("speed-mode-toggle");N&&(N.checked=ne(),N.addEventListener("change",()=>{An(N.checked),c("click"),Yt()}));const E=document.getElementById("bonus-rounds-toggle");E&&(E.checked=Nt(),E.addEventListener("change",()=>{Pn(E.checked),c("click")}));const se=document.getElementById("fps-toggle");se&&se.addEventListener("change",()=>{qt(),c("click")});const S=document.getElementById("high-contrast-toggle");if(S){S.checked=Ue(),S.addEventListener("change",()=>{yt(),c("click"),console.log("High contrast toggled to:",Ue())});const f=S.parentElement;f&&f.classList.contains("toggle-switch")&&f.addEventListener("click",j=>{j.target!==S&&(S.checked=!S.checked,yt(),c("click"),console.log("High contrast toggled (parent click) to:",Ue()))})}const F=document.getElementById("reduced-motion-toggle");if(F){F.checked=K(),F.addEventListener("change",()=>{bt(),c("click"),console.log("Reduced motion toggled to:",K())});const f=F.parentElement;f&&f.classList.contains("toggle-switch")&&f.addEventListener("click",j=>{j.target!==F&&(F.checked=!F.checked,bt(),c("click"),console.log("Reduced motion toggled (parent click) to:",K()))})}const lt=document.getElementById("reset-stats-settings-btn");lt&&lt.addEventListener("click",()=>{confirm("Are you sure you want to reset your statistics?")&&(ze(),c("click"))});const dt=document.getElementById("reset-achievements-btn");dt&&dt.addEventListener("click",()=>{confirm("Are you sure you want to reset your achievements?")&&(Ye(),Je(),c("click"))});const ut=document.getElementById("delete-all-data-btn");ut&&ut.addEventListener("click",()=>{confirm("Are you sure you want to delete ALL game data? This cannot be undone.")&&(Mt(),hs(),Ye(),ze(),Je(),it("day"),Pe(!0),c("click"),alert("All data has been deleted. The game will now reload."),window.location.reload())})}function Yt(){const e=document.getElementById("game-info-banner"),t=document.getElementById("game-info-text"),n=document.querySelector(".game-info-banner-icon");!e||!t||!n||(ne()?(e.classList.remove("hidden"),e.classList.add("speed-mode"),t.textContent="Speed Mode Active",n.textContent="⚡"):e.classList.add("hidden"))}function wt(e){const t=document.getElementById("ai-mode-description");let n="",s="";switch(e){case"cheeky":n="Cheeky Mode",s="This AI sometimes copies your last move (40% chance).";break;case"predictive":n="Predictive Mode",s="This AI analyzes your moves and tries to counter your most used choices.";break;case"random":default:n="Random Mode",s="AI picks a move randomly each turn.";break}t&&(t.innerHTML=`
            <h4>${n}</h4>
            <p>${s}</p>
        `)}function Gt(e){document.querySelectorAll(".tab-content").forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-hidden","true")});const n=document.getElementById(`${e}-tab`);n&&(n.classList.add("active"),n.setAttribute("aria-hidden","false")),document.querySelectorAll(".tab-btn").forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-selected","false"),o.getAttribute("data-tab")===e&&(o.classList.add("active"),o.setAttribute("aria-selected","true"))})}function zt(){document.getElementById("landing-page").classList.add("hidden"),document.getElementById("game-screen").classList.add("hidden"),document.getElementById("results-screen").classList.add("hidden"),document.getElementById("stats-screen").classList.add("hidden"),document.getElementById("settings-screen").classList.remove("hidden"),Gt("profile"),c("click")}function Hs(){document.getElementById("settings-screen").classList.add("hidden"),document.getElementById("landing-page").classList.remove("hidden"),c("click")}const rt="1.0";function _s(){try{const e=js();e.metadata={version:rt,exportDate:new Date().toISOString(),game:"RockPaperBattle"};const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(n),o=document.createElement("a");return o.href=s,o.download=`rock-paper-battle-save-${Ys(new Date)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),!0}catch(e){return console.error("Failed to export game data:",e),!1}}function js(){const e=l();return{settings:{soundEnabled:e.soundEnabled||!1,soundVolume:e.soundVolume||.5,ambientEnabled:e.ambientEnabled||!1,ambientVolume:e.ambientVolume||.3,audioStyle:e.audioStyle||"retro",theme:e.theme||"day",highContrast:e.highContrast||!1,reducedMotion:e.reducedMotion||!1},profile:e.profile||{name:"Player",avatar:"👤"},stats:e.stats||{wins:0,losses:0,draws:0,longestWinStreak:0,bestMode:""},achievements:e.achievements||{},game:{currentWinStreak:e.currentWinStreak||0,unlocks:e.unlocks||{},bonusRoundsEnabled:e.bonusRoundsEnabled||!0,speedModeEnabled:e.speedModeEnabled||!1},other:qs()}}function qs(){const e={};return Object.keys(localStorage).forEach(n=>{if(n.startsWith("RockPaperBattle_")||n==="hasRunBefore")try{e[n]=JSON.parse(localStorage.getItem(n))}catch{e[n]=localStorage.getItem(n)}}),e}function Ys(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function Gs(e){return new Promise((t,n)=>{if(!e){n({success:!1,message:"No file provided"});return}if(e.type!=="application/json"&&!e.name.endsWith(".json")){n({success:!1,message:"Invalid file type. Please select a JSON file"});return}const s=new FileReader;s.onload=o=>{try{const i=JSON.parse(o.target.result),r=zs(i);if(!r.valid){n({success:!1,message:r.message});return}confirm("This will replace your current game data. Continue?")?(Ks(i),t({success:!0,message:"Game data imported successfully!",stats:Qs(i)})):n({success:!1,message:"Import cancelled by user"})}catch(i){n({success:!1,message:`Failed to import data: ${i.message}`})}},s.onerror=()=>{n({success:!1,message:"Error reading file"})},s.readAsText(e)})}function zs(e){if(!e.metadata)return{valid:!1,message:"Invalid save file: Missing metadata"};if(e.metadata.game!=="RockPaperBattle")return{valid:!1,message:"Invalid save file: Not a Rock Paper Battle save file"};const t=e.metadata.version||"0";return Js(t)?!e.settings&&!e.profile&&!e.stats&&!e.achievements&&!e.game&&!e.other&&Object.keys(e).length<=1?{valid:!1,message:"Invalid save file: No game data found"}:{valid:!0}:{valid:!1,message:`Incompatible save file version: ${t} (current: ${rt})`}}function Js(e){const t=rt.split(".")[0],n=e.split(".")[0];return t===n}function Ks(e){if(delete e.metadata,Mt(),e.settings||e.profile||e.stats){const t={...e.settings,profile:e.profile,stats:e.stats,achievements:e.achievements,unlocks:e.game?.unlocks,currentWinStreak:e.game?.currentWinStreak,bonusRoundsEnabled:e.game?.bonusRoundsEnabled,speedModeEnabled:e.game?.speedModeEnabled};Object.entries(t).forEach(([n,s])=>{a(n,s)}),e.other&&Object.entries(e.other).forEach(([n,s])=>{try{localStorage.setItem(n,typeof s=="string"?s:JSON.stringify(s))}catch(o){console.error(`Failed to import key ${n}:`,o)}})}else Object.entries(e).forEach(([t,n])=>{try{localStorage.setItem(t,typeof n=="string"?n:JSON.stringify(n))}catch(s){console.error(`Failed to import key ${t}:`,s)}})}function Qs(e){const t={totalItems:0,achievements:0,stats:!1,profile:!1};if(e.settings||e.profile||e.stats)t.totalItems=Object.keys(e).length-1,e.achievements&&(t.achievements=Object.values(e.achievements).filter(n=>n===!0||n.unlocked===!0).length),e.stats&&(t.stats=!0),e.profile&&(t.profile=!0);else{if(t.totalItems=Object.keys(e).length-1,e.RockPaperBattle_achievements){const n=e.RockPaperBattle_achievements;t.achievements=Object.values(n).filter(s=>s.unlocked).length}e.RockPaperBattle_stats&&(t.stats=!0),e.RockPaperBattle_profile&&(t.profile=!0)}return t}let k=null;function Jt(){Zs()}function Zs(){const e=document.getElementById("loading-bar"),t=document.getElementById("loading-text");Ns(n=>{e&&(e.style.width=`${n}%`),t&&(t.textContent=`Loading game assets: ${n}%`)},()=>{t&&(t.textContent="Ready to play!"),setTimeout(Xs,500)})}function Xs(){const e=document.getElementById("loading-screen");e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500)),O("landing-page"),As(),Xt(),ls(),us(),dn(),fn(),tt(),kn(),ys(),Bn(),xn(),Ws(),xs(!1),eo(),so(),oo(),no(),to(),console.log("Game initialization complete")}function eo(){Qt({startEndlessMode:()=>{k="endless",Yn(),c("click"),Ge("Endless"),Yt()},backToMenu:()=>{k==="endless"?Zn():k==="bestOf5"&&cs(),z(),H()},playAgain:()=>{k==="endless"?Xn():k==="bestOf5"&&as(),z()},makeMove:E=>{H(),k==="endless"?Ie(E):k==="bestOf5"&&Ke(E),A()}});const e=document.getElementById("best-of-5-btn");e&&e.addEventListener("click",()=>{k="bestOf5",ts(),c("click"),Ge("Best of 5");const E=document.getElementById("game-info-banner");E&&E.classList.add("hidden")});const t=document.getElementById("reset-scores");t&&t.addEventListener("click",()=>{k==="endless"?es():k==="bestOf5"&&rs(),z()});const n=document.getElementById("sound-toggle");n&&n.addEventListener("click",tn);const s=document.getElementById("stats-btn");s&&s.addEventListener("click",()=>{St(),hn()});const o=document.getElementById("back-from-stats");o&&o.addEventListener("click",pn);const i=document.getElementById("reset-stats-btn");i&&i.addEventListener("click",()=>{confirm("Are you sure you want to reset all stats and achievements?")&&(ze(),Ye(),Je(),St(),c("click"))});const r=document.getElementById("settings-btn");r&&r.addEventListener("click",zt);const m=document.getElementById("fire-move-btn");m&&m.addEventListener("click",()=>{H();const E=m.getAttribute("data-move");k==="endless"?Ie(E):k==="bestOf5"&&Ke(E),A()});const b=document.getElementById("fps-toggle");b&&b.addEventListener("change",()=>{qt(),c("click")});const v=document.getElementById("export-data-btn");v&&v.addEventListener("click",()=>{_s(),c("click")});const N=document.getElementById("import-data-file");N&&N.addEventListener("change",E=>{const se=E.target.files[0];se&&Gs(se).then(S=>{alert(`Import successful! Imported ${S.stats.totalItems} items including ${S.stats.achievements} achievements.`),window.location.reload()}).catch(S=>{alert(`Import failed: ${S.message}`)})}),document.addEventListener("click",A),document.addEventListener("mousemove",A),document.addEventListener("keydown",A)}function to(){document.addEventListener("keydown",e=>{const t=document.getElementById("game-screen");if(t&&!t.classList.contains("hidden")&&(e.key==="Enter"||e.key===" ")&&document.activeElement.classList.contains("move-btn")){e.preventDefault();const n=document.activeElement.getAttribute("data-move");n&&(H(),k==="endless"?Ie(n):k==="bestOf5"&&Ke(n),A())}if(e.key==="Enter"||e.key===" "){if(document.activeElement.classList.contains("avatar-option")){e.preventDefault();const n=document.activeElement.getAttribute("data-avatar");n&&Ut(n)}if(document.activeElement.classList.contains("theme-option")){e.preventDefault();const n=document.activeElement.getAttribute("data-theme");n&&it(n)}}})}function no(){window.showWinAnimation=function(){if(K())return;const e=document.querySelector(".confetti-container");if(!e)return;e.innerHTML="";const t=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"];for(let n=0;n<50;n++){const s=document.createElement("div");s.className="confetti-piece",s.style.left=`${Math.random()*100}%`,s.style.top=`${Math.random()*50}%`,s.style.backgroundColor=t[Math.floor(Math.random()*t.length)],s.style.setProperty("--confetti-dx",`${(Math.random()-.5)*300}px`),s.style.setProperty("--confetti-rotate",`${Math.random()*360}deg`),e.appendChild(s)}setTimeout(()=>{e.innerHTML=""},2e3)},window.showLossAnimation=function(e){!e||K()||(e.classList.add("shake-effect"),setTimeout(()=>{e.classList.remove("shake-effect")},500))},window.showDrawAnimation=function(e){!e||K()||(e.classList.add("draw-effect"),setTimeout(()=>{e.classList.remove("draw-effect")},1e3))}}function St(){const e=document.getElementById("achievements-list");if(!e)return;const t=mn();e.innerHTML="",t.forEach(n=>{const s=document.createElement("div");s.className=`achievement-item ${n.unlocked?"unlocked":"locked"}`,s.setAttribute("role","listitem");const o=n.unlocked?"Unlocked":"Locked";s.setAttribute("aria-label",`${n.name} - ${o} - ${n.description}`),s.innerHTML=`
            <div class="achievement-icon">${n.icon}</div>
            <div class="achievement-content">
                <h4>${n.name}</h4>
                <p>${n.description}</p>
            </div>
        `,e.appendChild(s)})}function so(){l()}function oo(){l("hasRunBefore")||(a("hasRunBefore",!0),setTimeout(()=>{zt()},1e3))}function io(){$()}window.addEventListener("DOMContentLoaded",Jt);window.addEventListener("beforeunload",io);(document.readyState==="interactive"||document.readyState==="complete")&&Jt();
